var asynMgr=function(){var config_={CONTROL_IFRAME_ID:"iframeRecorder",CONTROL_IFRAME_URL:"",CONTROL_Input_ID:"inputRecorder",URL_STORAGE_LENGTH:2083,SERVER_GETTER_URL:"",SERVER_SETTER_URL:""},asynRelation_=[],repaintByMe_=false,dataStorage_,urlDataStorage_,serverDataStorage_,areaStateMgr_,formAreaStateMgr_;dataStorage_=function(){function saveData(data,options){options=options?options:{};var result=false,mode=options.mode||"url";dataForStorage={id:(Math.random()+"").substring(5,13),data:data};options.mode=options.mode||"url";options.duration=options.duration||86400;options.replace=options.replace===true?true:false;try{result=eval(mode+"DataStorage_").saveData(dataForStorage,options)}catch(e){}return result}function getData(id,mode,key){var result=rigel.isString(key)?"":{};mode=mode||"url";try{result=eval(mode+"DataStorage_").getData(id,mode,key)}catch(e){}return result}function getDataByUrl(key){return dataStorage_.getData("",null,key)}function saveDataByUrl(data,replace){var options={mode:"url",replace:replace===true?true:false};return dataStorage_.saveData(data,options)}function getSpecifyData(data,key){var result=rigel.isString(key)?"":{};if(rigel.isString(key)){result=data.data[key]||""}else{if(rigel.isArray(key)){for(var i=0,len=key.length;i<len;i++){var item=key[i];result[item]=data.data[item]}}else{result=data}}return result}return{saveData:saveData,getData:getData,getDataByUrl:getDataByUrl,saveDataByUrl:saveDataByUrl,getSpecifyData:getSpecifyData}}();urlDataStorage_=function(){var enabled_=false,shouldEnable_=false,docLoaded_=false,lastToken_="",timer_=null,unsetIframe_=true,hiddenIframe_,hiddenInput_,iframeSrc_=config_.CONTROL_IFRAME_URL,baseUrl_=window.location.href.split("#")[0]+"#",onHashChange_=function(e){var hash=getHash_(window);update_(hash)};var HAS_ONHASHCHANGE_=rigel.isIE&&document.documentMode>=8,INPUT_TEMPLATE_='<input type="text" name="#{0}" id="#{1}" style="display:none" />',IFRAME_TEMPLATE_='<iframe id="#{0}" style="display:none" #{1}></iframe>';function initRecorderIframe_(iframeInPage){if(HAS_ONHASHCHANGE_){return null}if(iframeInPage){hiddenIframe_=iframeInPage}else{if(rigel.isIE&&!iframeSrc_){iframeSrc_=window.location.protocol=="https"?"https:///":'javascript:""'}var srcAttribute=iframeSrc_?'src="'+rigel.string.encodeHTML(iframeSrc_)+'"':"",iframeId=config_.CONTROL_IFRAME_ID;document.write(rigel.string.format(IFRAME_TEMPLATE_,iframeId,srcAttribute));hiddenIframe_=rigel.g(iframeId)}return hiddenIframe_}function initRecorderInput_(inputInPage){if(inputInPage){hiddenInput_=inputInPage}else{var inputId=config_.CONTROL_Input_ID;document.write(rigel.string.format(INPUT_TEMPLATE_,inputId,inputId));hiddenInput_=rigel.g(inputId)}return hiddenInput_}function init(inputInPage,iframeInPage){initRecorderInput_(inputInPage);initRecorderIframe_(iframeInPage);if(rigel.isIE&&!HAS_ONHASHCHANGE_){rigel.domReady(function(){docLoaded_=true;if(hiddenInput_.value){setIframeToken_(hiddenInput_.value,true)}setEnabled(shouldEnable_)})}setHash_(getToken(),true);setEnabled(true)}function setEnabled(enabled){if(enabled==enabled_){return }if(rigel.isIE&&!HAS_ONHASHCHANGE_&&!docLoaded_){shouldEnable_=enabled;return }if(enabled){if(HAS_ONHASHCHANGE_){baidu.on(window,"hashchange",onHashChange_)}else{if(!rigel.isIE||docLoaded_){lastToken_=!rigel.isIE?getToken():lastToken_;timer_=setInterval(poll_,150)}}enabled_=true;if(arguments.callee.hasCalled){window.navCallback_&&window.navCallback_(getToken())}else{arguments.callee.hasCalled=true}}else{enabled_=false;baidu.un(window,"hashchange",onHashChange_);clearInterval(timer_)}}function update_(token){lastToken_=hiddenInput_.value=token;setHash_(token);if(rigel.isIE&&!HAS_ONHASHCHANGE_){setIframeToken_(token)}if(arguments.callee.hasCalled){window.navCallback_&&window.navCallback_(getToken())}else{arguments.callee.hasCalled=true}}function poll_(){var hash=getHash_(window);if(hash!=lastToken_){update_(hash)}if(rigel.isIE&&!HAS_ONHASHCHANGE_){var token=getIframeToken_()||"";if(token!=lastToken_){update_(token)}}}function getToken(){return getHash_(window)}function getHash_(w){var loc=w.location.href;var index=loc.indexOf("#");return index<0?"":loc.substring(index+1)}function getIframeToken_(){var iframeWindow=hiddenIframe_.contentWindow;if(rigel.isIE){var doc=iframeWindow.document;return doc.body?decodeURIComponent(doc.body.innerHTML):""}else{if(iframeWindow){var hash;try{hash=decodeURIComponent(getHash_(iframeWindow))}catch(e){}return hash||""}else{return""}}}function setToken(token,title){setHistoryState_(token,false,title)}function replaceToken(token,title){setHistoryState_(token,true,title)}function setHistoryState_(token,replace,title){if(getToken()!=token){setHash_(token,replace);if(!HAS_ONHASHCHANGE_){if(rigel.isIE){setIframeToken_(token,replace,title)}if(enabled_){poll_()}}}}function setHash_(hash,replace){var url=baseUrl_+(hash||""),loc=window.location;if(url!=loc.href){if(replace){loc.replace(url)}else{loc.href=url}}}function setIframeToken_(token,replace,title){if(unsetIframe_||token!=getIframeToken_()){unsetIframe_=false;token=encodeURIComponent(token);var iframeWindow=hiddenIframe_.contentWindow;if(rigel.isIE){var doc=iframeWindow.document;title=rigel.string.encodeHTML(title||window.document.title);doc.open("text/html",replace?"replace":undefined);doc.write("<title>"+title+"</title><body>"+token+"</body>");doc.close()}else{var url=iframeSrc_+"#"+token;if(iframeWindow){if(replace){iframeWindow.location.replace(url)}else{iframeWindow.location.href=url}}}}}function saveData(data,options){var replace=options.replace===true?true:false;var storedData=dataStorage_.getDataByUrl(),count=storedData.count||0;if(rigel.json.stringify(storedData.data)==rigel.json.stringify(data.data)){return false}data.mode="url";count++;data.count=count;var strData=rigel.json.stringify(data);var url=baseUrl_+strData;if(url.length>config_.URL_STORAGE_LENGTH){data.mode="server";serverDataStorage_.saveData(data,{mode:"server"});delete data.data;strData=rigel.json.stringify(data)}setToken(strData,replace);return data.id}function getData(id,mode,key){var result=rigel.isString(key)?"":{},storedDataStr=getToken(),storedDataObj={};if(!storedDataStr){return result}storedDataStr=rigel.isIE?storedDataStr:decodeURIComponent(storedDataStr);storedDataObj=rigel.json.parse(storedDataStr)||{};if(storedDataObj.mode=="server"){id=storedDataObj.id;return serverDataStorage_.getData(id,"server",key)}result=dataStorage_.getSpecifyData(storedDataObj,key);return result}return{init:init,getToken:getToken,setToken:setToken,setEnabled:setEnabled,replaceToken:replaceToken,saveData:saveData,getData:getData}}();serverDataStorage_=function(){function saveData(data,options){data.mode="server";var id=data.id,duration=options.duration?options.duration:86400,strData=encodeURIComponent(rigel.json.stringify(data)),params="id="+id+"&data="+strData+"&duration="+duration;rigel.ajax.request(config_.SERVER_SETTER_URL,{method:"POST",async:false,noCache:true,data:params})}function getData(id,mode,key){var result=baidu.isString(key)?"":{},params="id="+id;rigel.ajax.request(config_.SERVER_SETTER_URL,{method:"GET",async:false,noCache:false,data:params,onsuccess:function(xhr,responseText){var data=rigel.json.parse(responseText)||{};result=dataStorage_.getSpecifyData(data,key)}});return result}return{saveData:saveData,getData:getData}}();areaStateMgr_=function(){function set(id,stateData,type){type=type||"form";try{eval(type+"AreaStateMgr_").set(id,stateData)}catch(e){}}function get(id,type){type=type||"form";var ret="";try{ret=eval(type+"AreaStateMgr_").get(id)}catch(e){}return ret}return{get:get,set:set}}();formAreaStateMgr_=function(){function set(id,stateData){var queryObj=rigel.url.queryToJson(stateData),form=rigel.g(id),item,oItem,i,len,opts,itemName,itemType,itemValue,itemArr,itemValueArr;queryObj=decodeKeywordInJson_(queryObj);for(itemName in queryObj){item=form[itemName.replace(/_$/,"")];if(item){itemValue=queryObj[itemName];itemArr=item.nodeType==1?[item]:item;itemValueArr=rigel.isArray(itemValue)?itemValue:[itemValue];itemType=itemArr[0].type;switch(itemType){case"textarea":case"text":case"password":case"hidden":case"select-one":for(i=0,len=itemValueArr.length;i<len;i++){if(!itemArr[i]){continue}itemArr[i].value=itemValueArr[i]}break;case"radio":for(i=0,len=itemArr.length;i<len;i++){if(itemArr[i].value==itemValueArr[0]){itemArr[i].checked=true;break}}break;case"checkbox":for(i=0,len=itemArr.length;i<len;i++){if(rigel.array.indexOf(itemValueArr,itemArr[i].value)!=-1){itemArr[i].checked=true}else{itemArr[i].checked=false}}break;case"select-multiple":opts=itemArr[0].options;len=opts.length;for(i=0;i<len;i++){oItem=opts[i];if(rigel.array.indexOf(itemValueArr,oItem.value)!=-1){oItem.selected=true}else{oItem.selected=false}}break;default:break}}}form.onSetting&&form.onSetting(queryObj);form=null}function get(id){var form=rigel.g(id),elements=form.elements,len=elements.length,replacer=function(value,name){return value},data=[],i,item,itemType,itemName,itemValue,opts,oi,oLen,oItem;function addData(name,value){value=encodeKeyword_?encodeKeyword_(value):value;data.push(name+"="+value)}for(i=0;i<len;i++){item=elements[i];itemName=item.name;dataShield=item.getAttribute("data-shield");if(!item.disabled&&itemName){itemType=item.type;itemValue=item.value;itemName=dataShield?itemName+"_":itemName;switch(itemType){case"radio":case"checkbox":if(!item.checked){break}case"textarea":case"text":case"password":case"hidden":case"select-one":addData(itemName,replacer(itemValue,itemName));break;case"select-multiple":opts=item.options;oLen=opts.length;for(oi=0;oi<oLen;oi++){oItem=opts[oi];if(oItem.selected){addData(itemName,replacer(oItem.value,itemName))}}break;default:break}}}form=null;return data.join("&")}function encodeKeyword_(data){data=data||"";data=data.replace(/\&/g,"~1~");data=data.replace(/\=/g,"~2~");return data}function decodeKeyword_(data){data=data||"";data=data.replace(/\~1\~/g,"&");data=data.replace(/\~2\~/g,"=");return data}function decodeKeywordInJson_(queryJson){var retJson={},name,value,i,len;for(name in queryJson){value=queryJson[name];if(rigel.isString(value)){value=decodeKeyword_(value)}else{for(i=0,len=value.length;i<len;i++){value[i]=decodeKeyword_(value[i])}}retJson[name]=value}return retJson}return{get:get,set:set}}();filterAreaStateMgr_=function(){function set(id,stateData){var filterAreaEl=rigel.g(id),itemEls=filterAreaEl.getElementsByTagName("input"),i,len,itemEl,value;value=stateData.split("=")[1];for(i=0,len=itemEls.length;i<len;i++){itemEl=itemEls[i];if(itemEl.value==value){itemEl.checked=true;break}}}function get(id){var filterAreaEl=rigel.g(id),itemEls=filterAreaEl.getElementsByTagName("input"),i,len,itemEl,ret,name,value;for(i=0,len=itemEls.length;i<len;i++){itemEl=itemEls[i];if(itemEl.checked){name=itemEl.name;value=itemEl.value;ret=name+"="+value;break}}return ret}return{get:get,set:set}}();function convertToUrl(objQueryData){var ret=[],retStr,dataStr;for(var o in objQueryData){dataStr=objQueryData[o];if(dataStr){dataStr=dataStr.replace(/&?[^&=]+_=[^&=]*/g,"").replace(/^&/,"");dataStr=dataStr.replace(/\&/g,"(*1*)").replace(/\=/g,"(*2*)");dataStr=dataStr.replace(/\~1\~/g,"&").replace(/\~2\~/g,"=");dataStr=encodeURIComponent(dataStr);dataStr=dataStr.replace(/\(\*1\*\)/g,"&").replace(/\(\*2\*\)/g,"=");ret.push(dataStr)}}retStr=ret.join("&");return retStr}function isOn_(){return getAsynRelation_().length>0}function hasStore_(){return !!dataStorage_.getDataByUrl()["id"]}function setRepaintByMe(state){repaintByMe_=state}function getRepaintByMe(){return repaintByMe_}function getAsynRelation_(stateAreaId){var i=0,len=asynRelation_.length;if(!stateAreaId){return asynRelation_}for(;i<len;i++){var relationItem=asynRelation_[i];for(var j=0;j<relationItem.length;j++){var areaItem=relationItem[j];if(areaItem.id===stateAreaId){return relationItem}}}return[]}function initAsynRelation_(){var i=0,len=asynRelation_.length,tempArr=[];for(;i<len;i++){var relationItem=asynRelation_[i];tempArr[i]=[];for(var j=0;j<relationItem.length;j++){tempArr[i][j]={};var areaItem=relationItem[j];var areaItemArr=areaItem.split("#");tempArr[i][j]["type"]=areaItemArr[0];tempArr[i][j]["id"]=areaItemArr[1]}}asynRelation_=tempArr}function repaintTable(stateAreaId){var curAreaId=stateAreaId,curAreaType="",relation=getAsynRelation_(curAreaId),tableAreaId="",otherAreaIdList=[];for(var i=0,len=relation.length;i<len;i++){var item=relation[i];if(item.id==curAreaId){curAreaType=item.type}else{if(item.type=="table"){tableAreaId=item.id}else{otherAreaIdList.push(item.id)}}}var curAreaStateData=areaStateMgr_.get(curAreaId,curAreaType),areaStateData=dataStorage_.getDataByUrl(otherAreaIdList);areaStateData[curAreaId]=curAreaStateData;var tbControl=ecui.get(tableAreaId);tbControl&&tbControl.asynQuery(areaStateData)}function repaintTables(){if(!hasStore_()){return }var relation=getAsynRelation_(),item,itemRelation,hasTb,i,iLen,j,jLen,id,type,tbId,areaIdList,areaStateData;for(i=0,iLen=relation.length;i<iLen;i++){itemRelation=relation[i];hasTb=false;areaIdList=[];for(j=0,jLen=itemRelation.length;j<jLen;j++){item=itemRelation[j];id=item.id;type=item.type;if(type=="table"){hasTb=true;tbId=id}areaIdList.push(id)}if(hasTb){areaStateData=dataStorage_.getDataByUrl(areaIdList);tbControl=ecui.get(tbId);tbControl&&tbControl.recover(areaStateData)}}}function getCurState(stateAreaId){var relation=getAsynRelation_(stateAreaId),areaIdList=[];for(var i=0,len=relation.length;i<len;i++){areaIdList.push(relation[i]["id"])}return dataStorage_.getDataByUrl(areaIdList)}function updateStateData(data,replace){var ret=false;if(rigel.json.stringify(data)=="{}"){return ret}var historyStateData=dataStorage_.getDataByUrl(),stateData=historyStateData.data||{};for(var key in data){stateData[key]=data[key]}setRepaintByMe(false);ret=dataStorage_.saveDataByUrl(stateData,replace);return ret}function backfillState(){if(!isOn_()||!hasStore_()){return }var i=0,len=asynRelation_.length;for(;i<len;i++){var relationItem=asynRelation_[i];for(var j=0;j<relationItem.length;j++){var areaItem=relationItem[j];var stateData=dataStorage_.getDataByUrl(areaItem.id);areaStateMgr_.set(areaItem.id,stateData,areaItem.type)}}}function storeFirstState(){if(!isOn_()||hasStore_()){return }var i=0,j=0,len=asynRelation_.length,relationItem,areaItem,dataItem,data={};for(;i<len;i++){relationItem=asynRelation_[i];for(j=0;j<relationItem.length;j++){areaItem=relationItem[j];dataItem=areaStateMgr_.get(areaItem.id,areaItem.type);if(dataItem){data[areaItem.id]=dataItem}}}updateStateData(data,true)}function init(){urlDataStorage_.init();var callback=function(){},args=arguments,len=args.length;for(var i=0;i<len;i++){if(rigel.isArray(args[i])){asynRelation_.push(args[i])}}initAsynRelation_();if(rigel.isFunction(args[len-1])){callback=args[len-1]}rigel.domReady(function(){backfillState();callback()});if(hasStore_()){setRepaintByMe(true)}window.navCallback_=function(){if(!getRepaintByMe()){setRepaintByMe(true)}else{repaintTables();backfillState()}}}return{dataStorage:dataStorage_,urlDataStorage:urlDataStorage_,repaintTable:repaintTable,repaintTables:repaintTables,backfillState:backfillState,updateStateData:updateStateData,getCurState:getCurState,setRepaintByMe:setRepaintByMe,getRepaintByMe:getRepaintByMe,convertToUrl:convertToUrl,init:init}}();(function(){var core=ecui,dom=core.dom,ui=core.ui,util=core.util,ext=core.ext,lib=baidu,modalForm,$register=core.$register,setStyle=dom.setStyle,createDom=dom.create,removeDom=dom.remove,insertBefore=dom.insertBefore,attachEvent=util.attachEvent,standardEvent=core.event,toArray=lib.lang.toArray,each=lib.array.each,contains=lib.dom.contains,ieVersion=lib.browser.ie,_mapList={},_unitList=[],_controls={},_radioCheckedMap={},_POLLINGTIME=2000,EXT_CLICKSHIELD=ext.clickShield={},EXT_CLICKSHIELD_RULES=ruleMethods={};function getUId(el){var id;if(typeof (el)!="string"){(el.getUID)&&(id=el.getUID());(!id)&&(id=el.id)}return id?id:el}function getControl(id){return _controls[id]}function getUnitListById(id){return _unitList[_mapList[id]]}function wrapper(el,un){var par,mask,next,checked=null;if(el.type&&(el.type=="radio"||el.type=="checkbox")){next=lib.dom.next(el);if(next.tagName!="LABEL"||next.htmlFor!=el.id){next=null}(ieVersion<=7)&&(el.defaultChecked=el.checked)}if(un){el.className=el.className.replace(/\s\bdisabled\b/,"");par=el.parentNode;insertBefore(el,par);(next)&&(insertBefore(next,par));removeDom(par)}else{el.className+=" disabled";par=createDom("","position:relative;display:inline-block","span");mask=createDom("","position:absolute;top:0px;left:0px;_background:#000;_filter:alpha(opacity=0)");par.appendChild(mask);insertBefore(par,el);par.appendChild(el);(next)&&(par.appendChild(next));mask.style.height=par.offsetHeight+"px";mask.style.width=par.offsetWidth+"px"}}function polling(url,callback){lib.ajax.get(url,function(xht,res){res=eval("("+lib.string.trim(res)+")");if(res.isOK=="true"){callback.call(null)}else{setTimeout(function(){polling.call(null,url,callback)},_POLLINGTIME)}})}function maskFixed(un){each(toArray(document.getElementsByTagName("select")),function(n,i){if(un===false&&n.getAttribute("data-maskhide")=="true"){n.style.visibility="visible";n.removeAttribute("data-maskhide")}else{if(n.style.visibility!="hidden"&&!contains(modalForm.getOuter(),n)){n.setAttribute("data-maskhide","true");n.style.visibility="hidden"}}})}function initElement(id,type){var el,ev="click";if(type=="control"){el=(typeof (id)=="string")?_controls[id]:id;(el.onShieldInit)&&(el.onShieldInit())}else{el=(typeof (id)=="string")?document.getElementById(id):id;(el.tagName=="SELECT")&&(ev="change");attachEvent(el,ev,function(e){EXT_CLICKSHIELD.lock(el)})}}EXT_CLICKSHIELD.lock=function(id,un){var id=getUId(id),list=getUnitListById(id);if(list.lock===!un){return }else{list.lock=!un}for(var i=0,item;item=list[i];i++){EXT_CLICKSHIELD_RULES[item.type+"Lock"](item.id,un)}};EXT_CLICKSHIELD.unlock=function(id){this.lock(id,true)};EXT_CLICKSHIELD.register=function(id,type,unitIndex,config){var list,o={},obj;if(type=="control"){obj=(typeof (id)=="string")?core.get(id):id}id=getUId(id);if(unitIndex||unitIndex==0){list=_unitList[unitIndex]}else{list=[];list.lock=false;_unitList.push(list);unitIndex=_unitList.length-1}o.id=id;o.type=type;list.push(o);if(type=="control"){_controls[id]=obj}_mapList[id]=unitIndex;return unitIndex};EXT_CLICKSHIELD.auto=function(id,type,unitIndex,config){var idx=EXT_CLICKSHIELD.register(id,type,unitIndex,config);initElement(id,type);return idx};EXT_CLICKSHIELD.load=function(list,unitIndex){for(var i=0,item;item=list[i];i++){unitIndex=EXT_CLICKSHIELD.register(item.id,item.type,unitIndex)}return unitIndex};EXT_CLICKSHIELD_RULES.simpleLock=function(id,un){var el=document.getElementById(id),tag=el.tagName;if(tag=="INPUT"&&"submit|button".indexOf(el.type.toLowerCase())>=0){el.disabled=!(un==true)}else{if(ieVersion<=6&&tag=="SELECT"){if(un){setStyle(el,"visibility","visible")}else{setStyle(el,"visibility","hidden")}}else{wrapper(el,un)}}};EXT_CLICKSHIELD_RULES.controlLock=function(id,un){var control=_controls[id];if(un){(control.unlock)&&(control.unlock())}else{(control.lock)&&(control.lock())}};EXT_CLICKSHIELD_RULES.downloadLock=function(id,un){var el;if(!modalForm){el=createDom("floater","width:200px;height:50px;position:absolute");el.innerHTML='<label>提示</label><div class="floater-content"><div class="floater-inner">正在下载，请稍候...</div></div>';document.body.appendChild(el);modalForm=ecui.create("form",{element:el});modalForm.$getSection("Close").hide()}if(un){modalForm.hide()}else{modalForm.showModal();modalForm.center();(ieVersion<7)&&(maskFixed())}el=document.getElementById(id).getAttribute("rel");if(!el||un){return }setTimeout(function(){polling.call(null,el,function(){EXT_CLICKSHIELD.unlock(id)})},_POLLINGTIME)};$register("shield",function(el,params){var pars,idx;params.replace(/([A-Za-z0-9\-]+)\s*\(\s*([^)]+)\)/,function($0,$1,$2){pars=$2.split(/\s+/);idx=_mapList[pars[0]];if(pars[1]=="true"){idx=EXT_CLICKSHIELD.auto(el,$1,idx)}else{idx=EXT_CLICKSHIELD.register(el,$1,idx)}(!_mapList[pars[0]])&&(_mapList[pars[0]]=idx)})});(rigel)&&(rigel.clickShield=EXT_CLICKSHIELD)})();var ecomui=ecomui||{};(function(){var C=baidu,D=ecui,P=D.dom,AX=C.dom,m=D.ui,AO=D.util,w=ecomui,f=C.browser.ie,AL=D.$fastCreate,t=D.findControl,AH=P.create,AW=AO.blank||function(){},AM=AO.inherits,R=AO.copy,l=C.dom.g,O=C.dom.insertAfter,AB=D.string.toCamelCase,AI=D.get,k=D.query,AQ=C.string.trim,K=AX.setStyles,AK=P.children,Ah=P.insertHTML,X=P.setText,c=C.object.clone,AF=P.getStyle,b=D.getMouseX,a=D.getMouseY,AG=D.intercept,Ac=C.date,W=Ac.format,AC=Ac.parse,M="((\\d{4})-(\\d{1,2})-(\\d{1,2})?)",AZ=new RegExp("^"+M+"$"),AN=new RegExp("^"+M+"\\s+至\\s+"+M+"$"),U=new RegExp("^"+M+"\\s+(之(?:前|后))$"),A=/^\d{4}-\d{1,2}(-\d{1,2})?$/,V=Math.min,v=Math.max,o=AO.getView,y=m.Control,E=y.prototype,H=m.Calendar,Y=m.Select,AV=Y.prototype,AD=m.Edit,AS=AD.prototype,T,AE,j,p=(function(){var g=new Date();return{year:g.getFullYear(),month:g.getMonth(),range:"5y-5y",selectedDate:null}})(),L="yyyy-MM-dd",N=["range","month","year","selectedDate"],n=ecomui.EcomCalendar=m.EcomCalendar=function(Aj,Ak){y.call(this,Aj,Ak);var g=this.getBody(),Ai;g.innerHTML='<div class="date-content-sel"><table><tr>                <td><div class="prev month-nav"></div></td>                <td><select class="ec-select year-select"></select></td><td><span class="text-label">年</span></td>                <td><select class="ec-select month-select">$monthOptions</select></td><td><span class="text-label">月</span></td>                <td><div class="next month-nav"></div></td>                </tr></table></div>            <div class="ec-calendar ec-calendar"></div>';Ai=g.firstChild.getElementsByTagName("td");this.setClass("time-single");this._oInitProps=this.setProps(Ak);this._uCalGrid=AL(AT,g.lastChild,this);this._uYearSelect=Ai[1].firstChild;this._uMonthSelect=Ai[3].firstChild;this._uPrev=AL(x,Ai[0].firstChild,this,{category:"prev"});this._uNext=AL(x,Ai[5].firstChild,this,{category:"next"});this._uYearSelect._cWrapper=this._uMonthSelect._cWrapper=this;this._uYearSelect.onchange=this._uMonthSelect.onchange=Z;this._uCalGrid.ondateclick=Ae},T=AM(n,y),AT=function(g,Ai){H.call(this,g,Ai)},S=AM(AT,H),x=function(g,Ai){y.call(this,g,Ai)},q=AM(x,y),AU=function(Aj,Al){var Ak=this._sCategory=Al.category,Ai=[];Y.call(this,Aj,Al);if(Ak=="month"){for(var g=1;g<13;g++){this.append(g+"")}}},d=AM(AU,Y),Q=(function(){}).prototype;T.$cache=function(g,Ai){E.$cache.call(this,g,Ai);this._uCalGrid.cache()};T.$setSize=AW;T.$init=function(){E.$init.call(this);this._uCalGrid.init();var Ak=this._uYearSelect,g=this._uMonthSelect,Ai=ECOM_CALENDAR_PARSERANGE(this.$cal$range);r(Ak,Ai);for(var Aj=1;Aj<13;Aj++){try{g.add(new Option(Aj,Aj),null)}catch(Al){g.add(new Option(Aj,Aj))}}this.change()};function r(g,Ai){g.innerHTML="";for(var Al=Ai.from.getFullYear(),Aj=Ai.to.getFullYear();Al<=Aj;Al++){try{g.add(new Option(Al,Al),null)}catch(Ak){g.add(new Option(Al,Al))}}}T.setProps=function(Ai){var Ak=N,g={},Al,Aj=0,Am;for(;Am=Ak[Aj++];){Al=Ai[Am]!==undefined?Ai[Am]:this["$cal$"+Am]!==undefined?this["$cal$"+Am]:p[Am];this["$cal$"+Am]=Al;g[Am]=Al}return g};Q.reset=function(){var g=this.$getSection("Calendar");thisYear=g.getYear();thisMonth=g.getMonth();dayCount=new Date(thisYear,thisMonth,0).getDate();this.foreachDate(function(Ak,Aj){var Ai=new Date(thisYear,thisMonth-1,Ak._nDay);if(Ak._nDay>0&&Ak._nDay<dayCount+1){Ak.setEnabled(true)}});this._oSelectedDate=null;if(!this.onreset||this.onreset(this._oSettings)!=false){if(this._selectedDateGrid){this._selectedDateGrid.alterClass("selected",true);this._selectedDateGrid=null}}};T.foreachDate=function(Ak){var g=this._uCalGrid._uDate,Ai=0,Aj;for(;Aj=g.getItem(Ai++);){if(Aj){Ak.call(Aj,Aj,Ai)}}};w.parseCalRange=ECOM_CALENDAR_PARSERANGE=function(Ak){var Ak=Ak+"",Ai="(\\d{4}\\d{2}\\d{2}|now|\\d+(?:y|m))?",Ap=new RegExp(Ai+"-"+Ai),Aj=Ak.match(Ap),An=Aj[1],Am=Aj[2],g=new Date();g=new Date(g.getFullYear(),g.getMonth(),g.getDate());function Al(At){var As=/((\d{4})(\d{2})(\d{2}))|(now)/,Ar=At,Aq=At&&At.match(As);if(Aq){Aq[1]&&(Ar=new Date(Aq[2],Aq[3]-1,Aq[4]));Aq[5]&&(Ar=g)}return Ar}function Ao(Aq,Ay,Ax){var Az=/(\d+)(y|m)/,Au,Av,As,Aw,Ar,At;At=Ay||"5y";Au=At.match(Az);if(Au){Av=parseInt(Au[1]);Av=Ax?-Av:Av;As=Aq.getMonth();Aw=Aq.getFullYear();Ar=new Date(Aq);Au[2]=="y"?Ar=(Av>0)?new Date(Aw+Av,11,31):new Date(Aw+Av,0,1):Ar=(Av>0)?new Date(Aw,As+Av+1,0):new Date(Aw,As+Av,1)}return Ar}An=Al(An);Am=Al(Am);if(!(An instanceof Date)&&Am instanceof Date){An=Ao(Am,An,true)}if(!(Am instanceof Date)&&An instanceof Date){Am=Ao(An,Am)}if(!(An instanceof Date)&&!(Am instanceof Date)){An=Ao(g,An,true);Am=Ao(g,Am)}return{from:An,to:Am}};T.showRange=function(){var Ai=ECOM_CALENDAR_PARSERANGE(this.$cal$range),Ak=Ai.from,g=Ai.to,Ao=this._uCalGrid,Al=this.$cal$year,An=this.$cal$month,Am=new Date(Al,An+1,0).getDate(),Aj=this.$cal$selectedDate;this.foreachDate(function(Ar,Aq){var Ap=new Date(Al,An,Ar._nDay);if(Ap<Ak||Ap>g){Ar.setEnabled(false)}else{if(Ar._nDay>0&&Ar._nDay<Am+1){Ar.setEnabled(true)}}})};T.selectDate=function(g){if(g===null){this.setProps({selectedDate:g})}else{if(g.getFullYear){this.setProps({year:g.getFullYear(),month:g.getMonth(),selectedDate:g})}}};function Ae(Ai,g){var Aj=this.getParent();Aj.ondateclick.call(Aj,Ai,g)}T.ondateclick=function(Ai,g){this.selectDate(g);this.change()};q.$click=function(){var Ak=this.getParent(),Aj=Ak._uCalGrid,Ai=Ak._uPrev,g=Ak._uNext;this==Ai?Aj.move(-1):Aj.move(1);Ak.$cal$year=Aj._nYear;Ak.$cal$month=Aj._nMonth;Ak.change()};function Z(g){var Ai=this._cWrapper;/year/.test(this.className)&&(Ai.$cal$year=parseInt(this.value,10));/month/.test(this.className)&&(Ai.$cal$month=parseInt(this.value,10)-1);Ai.change()}T.$change=function(){var Aq=this._uYearSelect,Aj=this._uMonthSelect,Ak=this._uPrev,Am=this._uNext,Ao=this._uCalGrid,Ar=this.$cal$year,Ap=this.$cal$month+1,An=ECOM_CALENDAR_PARSERANGE(this.$cal$range);Aq.onchange=Aj.onchange=AW;r(Aq,An);for(var Al=0,Ai,g=false;Ai=Aq.options[Al];Al++){if(Ai.value.toString()==Ar.toString()){g=true;break}}if(g){Aq.value=Ar}else{Ar=Aq.options[0].value;Aq.value=Ar;this.$cal$year=Ar;Z.call(Aq)}Aj.value=Ap;Aq.onchange=Aj.onchange=Z;Ao.setDate(Ar,Ap);this.showRange();this.$cal$selectedDate!==undefined&&h(this)};function h(An){var Ak=An.$cal$selectedDate,Aj=An._uCalGrid._uDate;if(An._nSelectedIdx!==undefined){Aj.getItem(An._nSelectedIdx).alterClass("selected",true)}if(Ak){var Al=Ak.getFullYear(),Am=Ak.getMonth(),g=Ak.getDate(),Ao,Ai;if(Al==An.$cal$year&&Am==An.$cal$month){Ao=(new Date(Al,Am,0).getDay()+1)%7;Ai=An._nSelectedIdx=Ao+g-1;Aj.getItem(Ai).alterClass("selected")}}}var Af={},I=m.EcomCalendarEdit=function(Aj,An){var Am,Al,Ak,g,Ai,Ao=An.calType?AB("-"+An.calType):"Single";Aj.style.cssText=f&&f<8?"display:inline;zoom:1":"display:inline-block";y.call(this,Aj,An);this.alterClass(Ao.toLowerCase());Ak=this._uEdit=Aj.getElementsByTagName("input")[0];g=this._uClear=AL(y,Am=AH("ec-ecom-calendar-clear ec-ecom-calendar-clear ec-inline-block","position:absolute;"),this);Aj.appendChild(Am);if(Af[Ao]){Al=this._uCalendar=Af[Ao]}else{Al=this._uCalendar=AL(I[Ao],Am=AH("ec-ecom-calendar ec-ecom-calendar-"+Ao.toLowerCase(),"position:absolute;visibility:hidden;z-index:32768"));document.body.appendChild(Am);Af[Ao]=Al}if(!I._eIframe){Ai=I._eIframe=AH("","position:absolute;z-index:32766;border:0 none;display:none","iframe");Ai.frameBorder="0";document.body.appendChild(Ai)}Al.$show=i;Al.$hide=Ag;Al.$blur=AY;Ak._cWrapper=this;Ak._cCalendar=Al;Al._cWrapper=this;Al._eEdit=Ak;g.onclick=Aa;this._oCalProps=Al.setProps(Al.convertParams(An));Al.oneditcreate&&Al.oneditcreate(An)},AJ=AM(I,y);AJ.paint=function(){AS.paint.call(this);this._uCalendar.paint()};AJ.$init=function(){var g=this._uCalendar;E.$init.call(this);if(!g._bInited){g.$init();g.hide();g.getOuter().style.visibility="";g._bInited=true}};AJ.$setSize=function(Ai,g){E.$setSize.call(this,Ai,g)};AJ.$intercept=function(Aj){var Al=this._uCalendar,Ai=b(Al),g=a(Al);if(Ai<0||g<0||Ai>Al.getWidth()||a(Al)>Al.getHeight()){Al.hide()}else{var Ak=t(Aj.target);Ak&&Ak.click.call(Ak,Aj);AG(this)}};AJ.reset=function(){this._uCalendar.oneditreset&&this._uCalendar.oneditreset.call(this)};AJ.setValue=function(){var g=this._uCalendar.setEditValue;g&&g.apply(this,arguments)};AJ.clearValue=function(){var g=this._uCalendar.clearEditValue;g&&g.call(this)};AJ.$click=function(g){var Ai=this._uCalendar;Ai._cWrapper=this;Ai._eEdit=this._uEdit;Ai.show();AG(this)};function i(Ak){this.constructor.prototype.$show.call(this);var Aj=this._cWrapper.getOuter(),Ao=P.getPosition(Aj),g=o(),An=this.getOuter().offsetWidth,Ai=this.getOuter().offsetHeight,Am=g.right<Ao.left+An?Ao.left+Aj.offsetWidth-An:Ao.left,Al=g.bottom<Ao.top+Aj.offsetHeight+Ai?Ao.top-Ai:Ao.top+Aj.offsetHeight;this.setPosition(Am,Al);K(I._eIframe,{display:"block",width:An,height:Ai,left:Am,top:Al});this.alterProps();this.change()}function Ag(g){this.constructor.prototype.$hide.call(this);I._eIframe.style.display="none"}function AY(g){this.constructor.prototype.$blur.call(this);this.$hide()}function Aa(){this.getParent().clearValue()}var B=I.Single=function(g,Ai){n.call(this,g,Ai);this.ondateclick=F},AA=AM(B,n);AA.convertParams=function(g){var Ai=AQ(this._cWrapper._uEdit.value);if(Ai&&(Ai=AC(Ai))){g.selectedDate=Ai;g.year=Ai.getFullYear();g.month=Ai.getMonth()}else{g.selectedDate=null;g.year=p.year;g.month=p.month}return g};AA.alterProps=function(){var Ak=this._cWrapper,Aj=Ak._oCalProps,Ai=AQ(Ak._uEdit.value),g=Ai?AC(Ai):null;this.setProps(Aj);this.selectDate(g)};function F(Ai,g){var Aj=this._cWrapper._oCalProps;this.constructor.prototype.ondateclick.call(this,Ai,g);this._eEdit.value=W(g,L);this.hide();Aj.selectedDate=g;Aj.year=g.getFullYear();Aj.month=g.getMonth()}AA.oneditreset=function(){this._oCalProps=R({},this._oInitCalProps)};AA.setEditValue=function(Ai){var Ai=AQ(Ai),g=AC(Ai);if(g.constructor!==Date||!A.test(Ai)&&Ai!=""){throw new Error("日期格式错误!");return }else{this._uEdit.value=Ai;this._uCalendar.hide()}};AA.clearEditValue=function(){AA.setEditValue.call(this,"")};var Ab=I.Range=function(Aj,Al){y.call(this,Aj,Al);var g=this.getBody(),Ai,Ak;g.innerHTML='<div class="time-begin"><table><tr>                <td><span class="text-label">起始:</span></td><td><input readonly="readonly" type="text"  class="begin-cal-input ec-edit"/></td>                <td></td>                </tr></table><div class="single-cal"></div></div><div class="time-end"><table><tr>                <td><span class="text-label">结束:</span></td><td><input readonly="readonly" type="text" class="end-cal-input ec-edit"/></td>                <td></td>            </tr></table><div class="single-cal"></div></div>            <button>确定</button><button>取消</button><button style="display:none">重选</button><span class="calendar-error"></span>';Ai=g.getElementsByTagName("td");Ak=g.getElementsByTagName("button");this._uBeginText=Ai[1].firstChild;this._uEndText=Ai[4].firstChild;this._uBeginCal=AL(n,AK(g)[0].lastChild,this);this._uEndCal=AL(n,AK(g)[1].lastChild,this);this._uBeginCal._eText=this._uBeginText,this._uEndCal._eText=this._uEndText,this._uConfirmBtn=Ak[0];this._uCancelBtn=Ak[1];this._uResetBtn=Ak[2];this._uErrorTip=Ak[2].nextSibling;this._uBeginCal._cPeer=this._uEndCal;this._uEndCal._cPeer=this._uBeginCal;this._uConfirmBtn._cWrapper=this;this._uCancelBtn._cWrapper=this;this._uResetBtn._cWrapper=this;this._uBeginCal.selectDate=this._uEndCal.selectDate=Ad;this._uConfirmBtn.onclick=G;this._uCancelBtn.onclick=z;this._uResetBtn.onclick=J;this.onshow=s},AP=AM(Ab,y);AP.$setSize=function(Ai,g){E.$setSize.call(this,Ai,g);this._uBeginCal.setSize();this._uEndCal.setSize()};AP.$init=function(){E.$init.call(this);this._uBeginCal.init();this._uEndCal.init()};AP.oneditcreate=function(Ak){var g=this._cWrapper,As=g.getOuter(),Ao=As.getElementsByTagName("input"),Ap=["Begin","End"],Aj,Ar,Aq;function An(Au){var Av=ECOM_CALENDAR_PARSERANGE(Au),At="yyyyMMdd";return W(Av.from,At)+"-"+W(Av.to,At)}g._bLoose=Ak.loose||false;g._sBeginName=Ak.beginName||"dateFrom";g._sEndName=Ak.endName||"dateTo";g._sBeginVal=Ak.beginVal||"";g._sEndVal=Ak.endVal||"";g._sRange=An(Ak.range||p.range);if(Ao.length!=3){Ah(As,"beforeEnd",'<input type="hidden" name="'+g._sBeginName+'" value="'+g._sBeginVal+'"/><input type="hidden" name="'+g._sEndName+'" value="'+g._sEndVal+'"/>')}Ao=As.getElementsByTagName("input"),Ar=g._uBeginInput=Ao[1];Aq=g._uEndInput=Ao[2];g._sBeginVal=AQ(Ar.value)||g._sBeginVal;g._sEndVal=AQ(Aq.value)||g._sEndVal;g._sBeginVal&&this._uBeginCal.selectDate(AC(g._sBeginVal));g._sEndVal&&this._uEndCal.selectDate(AC(g._sEndVal));for(var Am=0,Aj;Aj=Ap[Am++];){for(var Al=0,Ai;Ai=N[Al++];){g._oCalProps["_o"+Aj+"Props"][Ai]=Ai=="range"?An(this["_u"+Aj+"Cal"]["$cal$"+Ai]):this["_u"+Aj+"Cal"]["$cal$"+Ai]}}g._oInitCalProps=c(g._oCalProps);g._uEdit.defaultValue=AR(g._uEdit,g._sBeginVal,g._sEndVal)};function s(g){X(this._uErrorTip,"")}function AR(Aj,g,Ai){var Ak="";if(g&&Ai){Ak=g+"至"+Ai}else{if(g&&!Ai){Ak=g+"之后"}else{if(!g&&Ai){Ak=Ai+"之前"}}}Aj.value=Ak;return Ak}function Ad(g){this.constructor.prototype.selectDate.call(this,g);var Aj=this.getParent(),Ai=this==Aj._uBeginCal?"Begin":"End";this._eText.value=g?W(g,L):"";u(this,g);this._cPeer.change()}function u(Am,Ai){var Al=Am._cPeer,Aj=Am==Am.getParent()._uBeginCal?"Begin":"End",Ak=Am.$cal$range,g=Al.$cal$range,An;if(Ai){An=g.split("-");An[Aj=="Begin"?0:1]=W(Ai,"yyyyMMdd");An=An.join("-");Al.$cal$range=An}else{Al.$cal$range=""+Am.getParent()._cWrapper._oInitCalProps["_o"+(Aj=="Begin"?"End":"Begin")+"Props"].range}}function G(Aj){var Ai=this._cWrapper,An=Ai._cWrapper._oCalProps,Aq=["Begin","End"],Am="",Ar="",g=true;if(!Ai._cWrapper._bLoose){if(!(Ai._uBeginCal.$cal$selectedDate&&Ai._uEndCal.$cal$selectedDate)){g=false;X(Ai._uErrorTip,"请选择"+(!Ai._uBeginCal.$cal$selectedDate?"开始":"结束")+"时间")}}if(g){for(var Ap=0,Al;Al=Aq[Ap++];){for(var Ao=0,Ak;Ak=N[Ao++];){An["_o"+Al+"Props"][Ak]=Ai["_u"+Al+"Cal"]["$cal$"+Ak]}}Am=Ai._cWrapper._uBeginInput.value=Ai._uBeginCal.$cal$selectedDate?W(Ai._uBeginCal.$cal$selectedDate,L):"";Ar=Ai._cWrapper._uEndInput.value=Ai._uEndCal.$cal$selectedDate?W(Ai._uEndCal.$cal$selectedDate,L):"";AR(Ai._cWrapper._uEdit,Am,Ar);Ai.hide()}}function z(g){var Ai=this._cWrapper;Ai.hide()}function J(Ai){var Aj=this._cWrapper,g=Aj._cWrapper;Aj.setProps(g._oInitCalProps);Aj.change()}AP.$change=function(){var g=this._uBeginCal.$cal$selectedDate,Ai=this._uEndCal.$cal$selectedDate;this._uBeginCal.change();this._uEndCal.change();if(g!==undefined){g===null?this._uBeginText.value="":(this._uBeginText.value=W(g,L))}if(Ai!==undefined){Ai===null?this._uEndText.value="":(this._uEndText.value=W(Ai,L))}};AP.setProps=function(g){return{_oBeginProps:this._uBeginCal.setProps(g._oBeginProps),_oEndProps:this._uEndCal.setProps(g._oEndProps)}};AP.alterProps=function(){var Ao=this._cWrapper,An=Ao._oCalProps,g=this._uBeginCal,Aj=this._uEndCal,Ai=AQ(Ao._uBeginInput.value),Ak=AQ(Ao._uEndInput.value),Al=Ai?AC(Ai):null,Am=Ak?AC(Ak):null;this.setProps(An);g.selectDate(Al);Aj.selectDate(Am)};AP.convertParams=function(Aj){var Ao=this._cWrapper,Ai={},Al=["Begin","End"];for(var Ak=0,An;An=Al[Ak++];){Ai["_o"+An+"Props"]={};for(var g=0,Am;Am=N[g++];){if(Am=="range"){Ai["_o"+An+"Props"][Am]=(Aj[AB([An.toLowerCase(),Am].join("-"))]||Aj[Am]||p[Am])+""}else{Ai["_o"+An+"Props"][Am]=Aj[AB([An.toLowerCase(),Am].join("-"))]||p[Am]}}}return Ai};AP.setEditValue=function(Al,Aj){var g=["Begin","End"],Ao={};for(var Ak=0,An;An=g[Ak];Ak++){var Am=AQ(arguments[Ak]),Ai=AC(Am);if(Ai.constructor!==Date||!A.test(Am)&&Am!=""){throw new Error("日期格式错误!");return }else{this["_u"+An+"Input"].value=Am;this._uCalendar.hide();Ao[An.toLowerCase()]=Am}}AR(this._uEdit,Ao.begin,Ao.end)};AP.clearEditValue=function(){var g=this._oInitCalProps;AP.setEditValue.call(this,"","");g._oBeginProps.range=this._sRange;g._oEndProps.range=this._sRange}})();(function(){var D=ecui,M=D.ui,H=D.util,C=void (0),O=D.dom.create,A=H.copy,N=H.inherits,G=D.$connect,F=D.$fastCreate,E=D.getParameters,L=M.Checkbox,B=M.Tree,J=B.prototype;var K=M.CheckTree=function(Q,S){S=A(A({},S),E(Q));B.call(this,Q,S);S.value=Q.getAttribute("value")||S.value;S.checked=Q.getAttribute("checked")||S.checked;(!S.noRelate)&&(this._sSuperior=S.superior);var P=0,R=this._uCheckbox=F(L,Q.insertBefore(O("ec-checkbox "+this.getBaseClass()+"-checkbox"),Q.firstChild),this,S),T=this.getChildTrees();if(!S.noRelate){for(;Q=T[P++];){S=Q._sSuperior;Q=Q._uCheckbox;S===C?Q.setSuperior(R):S!==true&&G(Q,Q.setSuperior,S)}}},I=N(K,B);I.$cache=function(P,Q){J.$cache.call(this,P,Q);this._uCheckbox.cache(true,true)};I.$init=function(){var Q=this.getChildTrees();this._uCheckbox.$init();J.$init.call(this);for(var P=0,R;R=Q[P];P++){R.$init()}};I.isChecked=function(){return this._uCheckbox.isChecked()};I.getChecked=function(){var R=this.getChildTrees(),Q=[];(this.isChecked())&&(Q.push(this));for(var P=0,S;S=R[P];P++){Q=Q.concat(S.getChecked())}return Q};I.getValue=function(){return this._uCheckbox.getValue()};I.setChecked=function(P){this._uCheckbox.setChecked(P)}})();var ecomui=ecomui||{};(function(){var C=ecui,J=baidu,K=C.ui,I=J.page,A=I.getViewWidth,M=I.getViewHeight,N=C.mask,D=J.dom.contains,F=J.lang.toArray,L=J.array.each,G=J.browser.ie,B=J.dom.query,E=K.Form,H=E.prototype;H.showModal=function(O,Q){var O=O||0.3,P=this.getOuter();Q===undefined&&document.body.appendChild(P);this.show();P.style.zIndex=32768;N(O)};H.onhide=function(){if(G<7){L(F(document.getElementsByTagName("select")),function(P,O){if(P.getAttribute("data-maskhide")=="true"){P.style.visibility="visible";P.removeAttribute("data-maskhide")}})}};ecomui.showModal=function(R,O,Q){var P=C.get(R);P.showModal(O,Q);P.center();P.getOuter().style.visibility="";if(G<7){L(F(document.getElementsByTagName("select")),function(T,S){if(T.style.visibility!="hidden"&&!D(P.getOuter(),T)){T.setAttribute("data-maskhide","true");T.style.visibility="hidden"}})}};ecomui.hideModal=function(O){C.get(O).hide()};H.setContent=function(O){B("div.floater-inner",floater.getOuter())[0].innerHTML=O}})();var ecomui=ecomui||{};(function(){var K=baidu,X=ecui,V=X.dom,O=X.ui,B=X.util,L=B.inherits,S=B.copy,J=B.blank,E=V.children,H=V.first,N=V.create,W=V.remove,G=X.$fastCreate,U=V.setText,D=baidu.ajax.request,F=document,I=O.Control,R=I.prototype,A;var Q=ecomui.Foldable=O.Foldable=function(b,d){var f=d.type,i=b.getElementsByTagName("label")[0],h=false,Z=E(b)[0],c=N(f+"-title"),a=(h=(i&&i==H(H(b))))?i.innerHTML:d.title||"",g=N(f+"-handler");b.style.position="relative";b.insertBefore(c,Z);c.innerHTML=a;h&&W(i);c.insertBefore(g,c.firstChild);d.capture=false;I.call(this,b,d);this._bInitFold=d.initFold||false;this._sAsyncUrl=d.asyncUrl;this._uTitle=G(I,c,this);this._uContent=G(I,Z,this,{capture:false});this._uHandler=G(I,g,this._uTitle,{capture:false});this._uTitle["on"+(d.trigger||"click")]=P},A=L(Q,I);A.$init=function(){R.$init.call(this);var Z=this._bInitFold;C.call(this._uTitle,Z);this._bInitFlushed=false;if(Z){this._uContent.getOuter().style.visibility="visible";this._uContent.getOuter().style.position="static"}this._sAsyncUrl&&!this._bAsyncLoaded&&!Z&&M.call(this,this._sAsyncUrl)};function P(){var Z=this.getParent();if(Z._sAsyncUrl&&!Z._bAsyncLoaded&&!Z._bLocked){M.call(Z,Z._sAsyncUrl)}C.call(this)}function C(k){var d=this.getParent(),j=d._uContent,l=d._uHandler,b=l.getBase(),c=k!==undefined?k:j.isShow(),f=d._bInitFlushed;c?j.hide():j.show();b.setAttribute("title",c?"点击展开":"点击折叠");this.alterClass(c?"unfold":"fold");this.alterClass(c?"fold":"unfold",true);if(f===false){if(!c){for(var g=0,Z,a=X.query({parent:j});Z=a[g++];){try{Z.resize()}catch(h){}}}d._bInitFlushed=true}}function M(a){var Z=this;this._bLocked=true;D(a,{method:"POST",data:"feReqTime="+new Date().getTime(),onsuccess:(function(){return function(c,b){T.call(Z,c,b)}})(),onfailure:(function(){return function(c,b){Y.call(Z,c,b)}})()})}function T(b,a){var Z=true;if(Z){this._uContent.getOuter().innerHTML=a;this._bLocked=false;this._bAsyncLoaded=true;this.onloadcsuccess&&this.onloadsuccess(b,a)}else{C(false);alert("异步返回不正确, 请稍后重试.")}}function Y(a,Z){alert(a.status)}A.$setSize=J;A.$resize=J})();var ecomui=ecomui||{};(function(){var W=ecui,P=W.ui,L=baidu,B=W.util,U=W.dom,F=L.browser.ie,N=W.setFocused,J=B.blank,H=W.$fastCreate,O=U.create,D=U.insertBefore,M=B.inherits,R=B.copy,G=U.children,X=U.getPosition,E=U.getStyle,T=U.setText,C=W.loseFocus,I=P.Control,Q=I.prototype,S=P.MultiSelect,K=S.prototype,V=ecomui.MultiSelect=P.EcomMultiSelect=function(Y,Z){},A=M(V,S)})();var ecomui=ecomui||{};(function(){var M=baidu,b=ecui,Z=b.dom,U=M.dom,T=b.ui,A=b.util,O=A.inherits,V=A.copy,L=A.blank,a=U.g,E=Z.children,R=Z.create,G=b.$fastCreate,Y=Z.setText,c=b.string.toCamelCase,W=b.string.trim,Q=Math,C=Q.ceil,F=document,I=T.Control,S=T.Item,P=T.Items,B=S.prototype,X=["curPage","pageSize","total"],K=ecomui.Pager=T.Pager=function(f,g){var m=[],k=g.bind,i=g.base,d;this.setProps(g);k&&(this._cBind=(typeof k=="string"?b.get(k):k));I.call(this,f,g);m.push('<div class="'+i+'-body">');m.push('<div class="'+i+"-first "+i+'-item">首页</div><div class="'+i+"-prev "+i+'-item">上一页</div>');var h=this.$getPageNumRange(),l=h[0],j=h[1];for(;l<=j;l++){m.push('<div class="'+i+'-item page-num">'+l+"</div>")}m.push('<div class="'+i+"-next "+i+'-item">下一页</div><div class="'+i+"-last "+i+'-item">尾页</div>');m.push("</div>");f.innerHTML=m.join("");this._eBody=f.firstChild;this.$initItems();d=this._uGoOp=R(i+"-go","","span");d.innerHTML='<input class="'+i+'-input" type="text" style="width:25px" /><button type="button" class="'+i+'-button">转到</button>';this._uGoInput=d.firstChild;(this._uGoBtn=d.lastChild)._cInput=this._uGoInput;this._uGoBtn._cWrapper=this;f.appendChild(d);d=R(i+"-summary","","span");d.innerHTML="<span>共<em></em>页, <em></em>条记录</span><span style='display:none'>不存在记录</span>";this._uSummaryText=d.firstChild;this._uNoRecText=d.lastChild;f.appendChild(d);d=this.getItems();this._uFirst=d[0];this._uLast=d[d.length-1];this._uPrev=d[1];this._uNext=d[d.length-2];this._uGoBtn.onclick=H;this.refresh()},D=O(K,I),J=K.Item=function(f,g){S.call(this,f,g);var d=Math.max(this.getWidth(),25);this.setSize(d)},N=O(J,S);D.$setSize=L;D.$getPageNumRange=function(){var i=this._nCurPage,g=this._nPageSize,h=this._nTotal,f=C(h/g),j=1,d=f+0;if(f>11){if(i>5){j=i-5;d=i+5}else{d=11}if(d>f){j=f-10;d=f}}return[j,d]};D.$getPageNumControl=function(){var g=0,f=[],d=this.getItems(),h;for(;h=d[g++];){/page-num/.test(h.getBase().className)&&f.push(h)}return f};D.$eachPageNum=function(g){var f=0,h,d=this.$getPageNumControl();for(;h=d[f++];){g.call(h,h.getBase().innerHTML)}};N.$click=function(h){var i=this.getBase(),f=this.getParent(),g=D.setCurPage,j=f._cBind,d=C(f._nTotal/f._nPageSize);if(/page-num/.test(i.className)){g.call(f,i.innerHTML)}else{if(/first/.test(i.className)){g.call(f,1)}else{if(/last/.test(i.className)){g.call(f,d)}else{if(/prev/.test(i.className)){g.call(f,f._nCurPage-1)}else{if(/next/.test(i.className)){g.call(f,f._nCurPage+1)}}}}}B.$click.call(this,h)};N.click=function(d){var g=this,f=this.getParent();g.$click.call(g,d);g.isEnabled()&&f.onclick&&f.onclick.call(g,d)};D.$alterItems=L;D.setProps=function(f){var d={},g=0,h;for(;h=X[g++];){this["_n"+c("-"+h)]=f[h]!==undefined?parseInt(f[h],10):this["_n"+c("-"+h)]}};D.refresh=function(){if(this._nCurPage&&this._nPageSize&&this._nTotal){this.getBody().style.display="";this._uGoOp.style.display="";this._uSummaryText.style.display="";this._uNoRecText.style.display="none";this.$setCurPage(this._nCurPage);this.setSummary(this._nPageSize,this._nTotal)}else{this.getBody().style.display="none";this._uGoOp.style.display="none";this._uSummaryText.style.display="none";this._uNoRecText.style.display=""}};D.refreshPage=function(d){this.setProps(d);this.refresh()};D.setSummary=function(d,h){var g=this._uSummaryText,f=g.getElementsByTagName("em");Y(f[0],C(h/d));Y(f[1],h)};function H(){var f=parseInt(W(this._cInput.value)),g=this._cWrapper,d=C(g._nTotal/g._nPageSize);if(f&&f>=1&&f<=d){g.setCurPage(f)}else{alert("请输入1到"+d+"之间的数字.");this._cInput.value="";this._cInput.focus()}}D.$setCurPage=function(p){var q=this,p=parseInt(p,10),g=C(this._nTotal/this._nPageSize),l=0,k=0,f,n=this.$getPageNumControl();if(p==-1){p=g;this._nCurPage=g}else{if(p<1){this._nCurPage=1}else{if(p>g){this._nCurPage=g}else{this._nCurPage=p}}}var m=this.$getPageNumRange(),d=m[0],h=m[1];for(l=d;l<=h;){f=n[k];f.getBase().innerHTML=l;if(l==p){f.alterClass("cur");f.setEnabled(false)}else{f.alterClass("cur",true);f.setEnabled(true)}k++;l++}this._uPrev.setEnabled(this._nCurPage!=1);this._uFirst.setEnabled(this._nCurPage!=1);this._uNext.setEnabled(this._nCurPage!=g);this._uLast.setEnabled(this._nCurPage!=g)};D.setCurPage=function(d){var f=this;f.isEnabled()&&f.onpageset&&f.onpageset.call(f,d)===false||f.$setCurPage.call(f,d)};D.getCurPage=function(){return this._nCurPage+0};D.getBind=function(){return this._cBind};D.setBind=function(d){this._cBind=d};V(D,P)})();(function(){var R=ecui,P=R.dom,J=R.ui,A=R.util,B=P.getStyle,Q=P.remove,S=P.setInput,G=A.blank,M=A.copy,H=A.inherits,N=A.toNumber,E=R.getMouseX,I=R.getParameters,D=J.Tree,K=J.Tree.prototype,L=J.Control.prototype;var O=J.RadioTree=function(T,U){U=M(M({},U),I(T));this._sValue=T.getAttribute("value")||U.value;this._sName=U.name;this._nfixLeftPadding=parseInt(U.fixPadding,10);D.call(this,T,U)},F=H(O,D);function C(T,U){T._eInput||T.getBody().appendChild(T._eInput=S("",T.getName(),"hidden"));T._eInput.value=U}F.$click=function(V){var W=this._nfixLeftPadding?this._nfixLeftPadding:0,T=E(this);if(T<=N(B(this.getBase(),"paddingLeft"))&&T>=W){var U=this.getRoot();U._cSelected&&U._cSelected.alterClass("select",true);this.alterClass("select");U._cSelected=this;C(U,this._sValue);this.setFold=G}K.$click.call(this,V);delete this.setFold};F.$dispose=function(){this._eInput=null;K.$dispose.call(this)};F.getName=function(){return this._sName};F.getSelected=function(){return this.getRoot()._cSelected};F.getValue=function(){return this._sValue};F.setParent=function(U){var T=this.getRoot();K.setParent.call(this,U);if(T._cSelected==this){this.alterClass("select",true);T._cSelected=null;C(T,"")}if(this._cSelected){this._cSelected.alterClass("select",true);this._cSelected=null;this._eInput&&Q(this._eInput)}}})();(function(){var c=ecui,a=c.dom,T=c.ui,B=c.util,d=Math.max,C=c.array.indexOf,G=a.children,S=a.create,b=a.remove,L=a.first,E=a.insertBefore,F=a.setStyle,N=B.blank,W=B.copy,P=B.inherits,Z=B.toNumber,J=c.$fastCreate,Y=c.Timer,M=T.Control,V=M.prototype,U=T.Tab,X=U.prototype,D=U.Button,I=D.prototype,f=c.ext.Tween;var R=T.EcomTab=function(g,h){U.call(this,g,h)},O=P(R,U),Q=R.Item=function(h,j){U.Item.call(this,h,j);if(j.closable){var g=L(this.getBody());var i=S(j.base+"-close "+j.type+"-close","","span");i.innerHTML="x";J(K,i,this);g.appendChild(i)}},H=P(Q,U.Item),K=function(g,h){M.call(this,g,h)},A=P(K,M);O.addTab=function(g,k){var i=S("","","div"),j;var h={index:null,title:"无标题",params:{},background:false};h=W(h,g);i.innerHTML="<label>"+h.title+"</label>";this.getBody().appendChild(i);j=this.add(i,h.index,h.params);j.resize();if(!h.background){this.setSelected(j)}else{j.getContent()&&(j.getContent().style.display="none")}k&&k.call(this,j);this.resize()};A.$click=function(h){V.$click.call(this,h);var i=this.getParent(),g=i.getParent();g.remove(i);g.resize()};O.setSelected=function(g){X.setSelected.call(this,g);this.resize()};R.Item.prototype.oncreate=function(g){if(!g.decorate){new ecui.ext.LRDecorator(this,"ecom-tab-item-dtr");F(this.getOuter(),"display","inline-block")}};f(I,{pressStep:10,monitor:"getParent().getBody().style.left"})})();var ecomui=ecomui||{},asynMgr=asynMgr||{};try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}(function(){var lib=baidu,core=ecui,dom=core.dom,libDom=lib.dom,ui=core.ui,string=core.string,init=core.init,domQuery=lib.dom.query,children=dom.children,insertHTML=dom.insertHTML,ieVersion=lib.browser.ie,ffVersion=lib.browser.firefox,$fastCreate=core.$fastCreate,createControl=core.create,util=core.util,inherits=util.inherits,copy=util.copy,toNumber=util.toNumber,get=core.get,query=core.query,on=lib.event.on,each=lib.array.each,blank=util.blank,disposeControl=core.dispose,loseFocus=core.loseFocus,removeDom=dom.remove,setText=dom.setText,getText=dom.getText,toCamelCase=string.toCamelCase,libAjax=lib.ajax,post=libAjax.post,request=libAjax.request,jsonToStr=lib.json.stringify,queryToJson=lib.url.queryToJson,createDom=dom.create,getViewWidth=lib.page.getViewWidth,getViewHeight=lib.page.getViewHeight,getScrollTop=lib.page.getScrollTop,setStyles=lib.dom.setStyles,getPosition=dom.getPosition,calcHeightRevise=core.calcHeightRevise,first=libDom.first,last=libDom.last,trim=lib.string.trim,getParameters=core.getParameters,ASYNCSTATEMGR=asynMgr,CLICKSHIELD,DOCUMENT=document,UI_LOCKED_TABLE=ui.LockedTable,UI_LOCKED_TABLE_CLASS=UI_LOCKED_TABLE.prototype,UI_TABLE=ui.Table,UI_TABLE_CLASS=UI_TABLE.prototype,UI_CONTROL=ui.Control,UI_CONTROL_CLASS=UI_CONTROL.prototype,UI_CHECKBOX=ui.Checkbox,UI_PAGER=ui.Pager,UI_PAGER_CLASS=UI_PAGER_CLASS,UI_SCROLL=ui.Scroll,UI_SCROLL_CLASS=UI_SCROLL.prototype,ECOM_TABLE_URL_DEFAULTS={pageParam:"page.curPageNum",orderByParam:"orderBy",descParam:"desc"},ECOM_TABLE=ecomui.Table=ui.EcomTable=function(el,params){var defaultUrl=params.defaultUrl,tbEl,pgEl,i=0,o,tmp;params.capture=false;this._sDefaultUrl=defaultUrl;this._sQueryUrl=params.queryUrl||defaultUrl;this._sPageUrl=params.pageUrl||defaultUrl;this._sSortUrl=params.sortUrl||defaultUrl;this._nTbId=params.tbId;for(o in ECOM_TABLE_URL_DEFAULTS){this["_s"+toCamelCase("-"+o)]=params[o]||ECOM_TABLE_URL_DEFAULTS[o]}UI_CONTROL.call(this,el,params);o=this._eMask=createDom("","position:absolute;opacity:0.7;filter:alpha(opacity=70);                            background-color:#FFF;top:0;left:0;display:none;                            z-index:32765;font-size:14px;text-align:center");o.innerHTML="<span class='ec-ecom-table-loading'></span>";if((tmp=children(el)).length>=1){tbEl=domQuery(".ec-ecom-table-el",el)[0];pgEl=domQuery(".ec-ecom-pager-el",el)[0];this._uTable=$fastCreate(ECOM_TABLE_BODY,tbEl,this,getParameters(tbEl));pgEl&&(this._uPager=$fastCreate(ECOM_PAGER,pgEl,this,getParameters(pgEl)));el.insertBefore(o,children(el)[0])}else{el.appendChild(o);if(jsonToStr(o=ASYNCSTATEMGR.getCurState("lst_"+this._nTbId))!="{}"){this.recover(o)}else{this.post(params.defaultUrl)}}},ECOM_TABLE_CLASS=inherits(ECOM_TABLE,UI_CONTROL),ECOM_TABLE_BODY=ui.EcomTableBody=function(el,params){el.innerHTML=el.innerHTML.replace(/>(\s+)</g,"><");var o,outerWidth;o=el.parentNode.getControl();try{outerWidth=(o._nWidth+0)||o.getOuter().offsetWidth}catch(e){outerWidth=Math.min(el.parentNode.offsetWidth,getViewWidth()-80)}outerWidth=outerWidth-2;el.style.width=outerWidth+"px";UI_LOCKED_TABLE.call(this,el,params);this._bSyncOp=params.syncOp==true;this._bCustom=params.custom;this._bNoData=params.noData===true;if(params.rightLock){this._bOpColUnfolded=true;el=this.getBase();(this._uColToggler=$fastCreate(UI_CONTROL,o=createDom("ec-col-toggler"),this)).$click=ECOM_TABLE_TOGGLERCLICK;el.appendChild(o);ieVersion>=8&&(o.style.display="none");(this._uVerticalBar=$fastCreate(ECOM_TABLE_VBAR,o=createDom("ec-v-toggler"),this)).$click=ECOM_TABLE_VBARCLICK;o.innerHTML="<div></div>";el.appendChild(o);this._uVerticalBar.hide();this._uVerticalBar.show=ECOM_TABLE_VBARSHOW;o=this._uVScroll;this._uColToggler.getOuter().style.right=((o&&o.isShow())?o.getWidth():0)+"px"}if(params.floatThead){var self=this;self._bFloatThead=true;on(window,"scroll",function(){ECOM_TABLE_FLOATTHEAD(self)})}},ECOM_TABLE_BODY_CLASS=inherits(ECOM_TABLE_BODY,UI_LOCKED_TABLE),ECOM_PAGER=ui.EcomPager=function(el,params){UI_PAGER.call(this,el,params)},ECOM_PAGER_CLASS=inherits(ECOM_PAGER,UI_PAGER),ECOM_TABLE_VBAR=function(el,params){UI_CONTROL.call(this,el,params)},ECOM_TABLE_VBAR_CLASS=inherits(ECOM_TABLE_VBAR,UI_CONTROL),ECOM_TABLE_BODY_ROW=ECOM_TABLE_BODY.Row=function(el,params){UI_LOCKED_TABLE.Row.call(this,el,params);var o=el.cells[0].getElementsByTagName("input");if(o[0]&&o[0].type=="checkbox"){o=o[0];o.value=trim(o.value);this._cCheckbox=createControl("checkbox",{element:o,superior:o.getAttribute("data-superior")})}},ECOM_TABLE_BODY_ROW_CLASS=inherits(ECOM_TABLE_BODY_ROW,UI_LOCKED_TABLE.Row);ECOM_TABLE_CLASS.$cache=function(style,cacheSize){UI_CONTROL_CLASS.$cache.call(this,style,cacheSize);this._uTable&&this._uTable.cache();this._uPager&&this._uPager.cache()};ECOM_TABLE_CLASS.$init=function(){UI_CONTROL_CLASS.$init.call(this);this._uTable&&this._uTable.init();this._uPager&&this._uPager.init();document.body.offsetWidth;this._uTable&&this.resize()};ECOM_TABLE_CLASS.$setSize=blank;ECOM_TABLE_CLASS.$resize=function(){var that=this,fn=function(){var outer=that.getOuter(),table=that._uTable,pager=that._uPager,width,scrollTop;if(table&&table.getOuter()){scrollTop=getScrollTop();table.hide();pager&&pager.hide();document.body.offsetWidth;outer.style.width="100%";width=outer.offsetWidth;outer.style.width="";table.show();pager&&pager.show();width=ieVersion<8?width:outer.offsetWidth;table.setSize(width);if(table._uVerticalBar&&table._uVerticalBar.isShow()){table._uVerticalBar.resize()}document.body.offsetWidth;outer.className+="";window.scrollTo(0,scrollTop)}};if(ieVersion<7){setTimeout(fn,10)}else{fn()}};ECOM_TABLE_CLASS.onresize=function(){};ECOM_TABLE_CLASS.onShieldInit=function(){CLICKSHIELD=core.ext.clickShield};ECOM_TABLE_BODY_CLASS.$init=function(){UI_LOCKED_TABLE_CLASS.$init.call(this);var headCell=this.getCol(0).getOuter(),o;this._uOpCol=this.getCol(this._aCol.length-1);o=headCell.getElementsByTagName("input");if(o[0]&&o[0].type=="checkbox"){o=o[0];this._cHeadCheckbox=createControl("checkbox",{id:o.getAttribute("data-id"),element:o})}this._uHead.getBody().cells[0].getControl().constructor.prototype.$click=ECOM_TABLE_HEADCELLCLICK;if(this._bCustom){var customBtn=core.get("cbCtnr_"+this._nTbId);customBtn&&ECOM_TABLE_CUSTOMBTNINIT(customBtn,this)}};ECOM_TABLE_CLASS.post=function(url,options){var asyncMgr=this._oAsyncMgr=new ASYNCMGR();this.setLocked(true);asyncMgr.beforePost=ECOM_TABLE_BEFOREPOST;asyncMgr.onerror=this.onReqError;asyncMgr.post(this,url,options).$success=function(control,xhr,res,reqInfo){this.constructor.prototype.$success.call(this,control,xhr,res,reqInfo);var data=reqInfo.data;ASYNCSTATEMGR.updateStateData(data);control.onReqSuccess&&control.onReqSuccess.call(this,control,xhr,res)};return asyncMgr};ECOM_TABLE_CLASS.recover=function(data){var asyncMgr=this._oAsynMgr=new ASYNCMGR(),urlType=queryToJson(ECOM_TABLE_GETTBSTATE(this,data)).urlType||"default",url=this["_s"+toCamelCase("-"+urlType)+"Url"];this.setLocked(true);asyncMgr.beforePost=ECOM_TABLE_BEFOREPOST;asyncMgr.post(this,url,{data:data}).$success=function(control,xhr,res,reqInfo){this.constructor.prototype.$success.call(this,control,xhr,res,reqInfo);control.onReqSuccess&&control.onReqSuccess.call(this,control,xhr,res)};return asyncMgr};function ECOM_TABLE_GETTBSTATE(control,data){return data["lst_"+control._nTbId]||""}function ECOM_TABLE_SETTBSTATE(control,data,str){data["lst_"+control._nTbId]=str;return data}function ECOM_TABLE_BEFOREPOST(control,url,options){var data=ASYNCSTATEMGR.convertToUrl(options.data);return{url:url,data:data}}ECOM_TABLE_CLASS.asynQuery=function(data){var o=ECOM_TABLE_GETTBSTATE(this,data),data;o+="&urlType=query";data=ECOM_TABLE_SETTBSTATE(this,data,o);this.post(this._sQueryUrl,{data:data})};ECOM_PAGER_CLASS.$init=function(){UI_PAGER.$init&&UI_PAGER.$init.call(this);this.setSize(this.getParent()._uTable.getWidth())};function ECOM_TABLE_TOGGLERCLICK(event){UI_CONTROL_CLASS.$click.call(this,event);var table=this.getParent(),vBar=table._uVerticalBar;ECOM_TABLE_TOGGLEOPCOL(table)}function ECOM_TABLE_TOGGLEOPCOL(control,foldFlag){var foldFlag=foldFlag||control._bOpColUnfolded,col=control.getCol(control.getCols().length-2);control._uOpCol[foldFlag?"hide":"show"]();if(control._uHScroll&&control._uHScroll.isShow()){col.setSize(col.getWidth());document.body.offsetWidth;control.setSize(control.getParent().getWidth()-control.getParent().getInvalidWidth())}else{document.body.offsetWidth;col.setSize(col.getWidth()+(foldFlag?1:-1)*control._uOpCol.getWidth())}control._uColToggler.alterClass("o",!foldFlag);control._uVerticalBar[foldFlag?"show":"hide"]();control._bOpColUnfolded=!foldFlag}function ECOM_TABLE_VBARCLICK(event){UI_CONTROL_CLASS.$click.call(this,event);ECOM_TABLE_TOGGLEOPCOL(this.getParent(),false)}function ECOM_TABLE_VBARSHOW(){UI_CONTROL.prototype.show.call(this);this.resize()}function ECOM_TABLE_FLOATTHEAD(t){var headEl=t._uHead.getOuter(),lockedHeadEl=t._uLockedHead.getOuter(),lockedMainEl=t._uLockedMain.getOuter();if(t._uColToggler){var colTogglerEl=t._uColToggler.getOuter()}var outer=t.getOuter();var scrollTop=DOCUMENT.body.scrollTop||DOCUMENT.documentElement.scrollTop,pos=getPosition(outer),top=pos.top+1,left=pos.left;var headHeight=headEl.offsetHeight+calcHeightRevise(headEl),tbHeightDelta=t.getHeight()-headHeight,relativeTop=scrollTop-top;var floatStyles={position:"absolute",top:relativeTop+"px",zIndex:999};if(scrollTop&&relativeTop>0&&relativeTop<tbHeightDelta){setStyles(headEl,floatStyles);setStyles(lockedHeadEl,floatStyles);setStyles(lockedMainEl,{top:headHeight+"px"});setStyles(lockedHeadEl,{width:lockedHeadEl.getElementsByTagName("table")[0].style.width});if(colTogglerEl){setStyles(colTogglerEl,{top:2+relativeTop+"px",zIndex:999})}}else{setStyles(headEl,{top:0,zIndex:0});setStyles(lockedHeadEl,{position:"static",zIndex:0});setStyles(lockedMainEl,{top:""});if(colTogglerEl){setStyles(colTogglerEl,{top:"",zIndex:0})}}}function ECOM_TABLE_CUSTOMBTNINIT(customBtn,table){var tbId=table._nTbId;var popup=core.get("cbPop_"+tbId),popupItems=core.query({parent:popup}),popupItemsLen=popupItems.length;var cbCurList=core.get("cball_"+tbId),cbWholeList=core.get("cbsall_"+tbId),cbCurInferiors=cbCurList.getInferiors();DOCUMENT.body.appendChild(popup.getOuter());customBtn.onclick=function(){var containerOuter=this.getOuter();containerPos=getPosition(containerOuter);popup.setPosition(containerPos.left+this.getBodyWidth(),containerPos.top);popup.show()};cbWholeList.onclick=(function(){var checked=false;return function(){var i=cbCurInferiors.length,msg=["已选择整列表, 子项目不能取消选择","已取消选择整列表"];var msgBox=table.setMsg((!checked)?msg[0]:msg[1]);msgBox.parentNode.parentNode.style.visibility="visible";var hcbsall=lib.dom.g("hcbsall_"+tbId);while(i--){cbCurInferiors[i].setChecked(!checked);cbCurList.setEnabled(checked);cbCurInferiors[i].setEnabled(checked)}hcbsall.value=checked?0:1;checked=!checked}})();while(popupItemsLen--){popupItems[popupItemsLen].onclick=function(){var cb=core.query({parent:this})[0];cb.click()}}}ECOM_TABLE_VBAR_CLASS.$resize=function(){UI_CONTROL_CLASS.$resize.call(this);var table=this.getParent(),width=this.getWidth(),vScroll=table._uVScroll,hScroll=table._uHScroll,style=table.getBase().style,contentWidth=table.getWidth()-(toNumber(style.borderLeftWidth)+toNumber(style.borderRightWidth)),o;style=this.getOuter().style;style.left=contentWidth-width-((vScroll&&vScroll.isShow())?vScroll.getWidth():0)+"px";if(hScroll&&hScroll.isShow()){o=hScroll.isShow()?hScroll.getHeight():0}else{o=0}this.setSize(0,table.getBodyHeight()-o);style.bottom=o+"px"};ECOM_TABLE_BODY_CLASS.$setSize=function(width,height){if(this._cVScroll&&!this._cVScroll.isShow()){this._cVScroll._nWidth=0}try{UI_LOCKED_TABLE_CLASS.$setSize.call(this,width,height);if(ffVersion){for(var i=0,o,lockedRow;lockedRow=this._aLockedRow[i++];){o=lockedRow._cJoint.getCol(this._nLeft).getOuter();o.getElementsByTagName("div")[0].style.height=o.style.height}}}catch(e){}};ECOM_TABLE_BODY_CLASS.$resize=function(){UI_LOCKED_TABLE_CLASS.$resize.call(this);this._uVerticalBar&&this._uVerticalBar.resize();this._bFloatThead&&ECOM_TABLE_FLOATTHEAD(this)};function ECOM_TABLE_HEADCELLCLICK(event){var el=this.getOuter(),o;if((o=el.getAttribute("sort"))!==null){ECOM_TABLE_BODY_CLASS.sort.call(this,o)}UI_CONTROL_CLASS.$click.call(this,event)}ECOM_TABLE_BODY_CLASS.$sort=function(orderBy){var parent=this.getParent().getParent(),orderByParam=parent._sOrderByParam,descParam=parent._sDescParam,sortUrl=parent._sSortUrl,desc,data=ASYNCSTATEMGR.getCurState("lst_"+parent._nTbId),sortProps=[[orderByParam,orderBy].join("="),[descParam,desc=parent.getNextDesc(orderBy)].join("=")].join("&");sortProps+="&urlType=sort";data=ECOM_TABLE_SETTBSTATE(parent,data,sortProps);parent.post(sortUrl,{data:data})};ECOM_TABLE_CLASS.getNextDesc=function(orderBy){return this._sOrderByVal==orderBy?!this._bDesc:false};ECOM_TABLE_BODY_CLASS.sort=function(orderBy){var o=this.getParent();o.isEnabled()&&o.onsort&&o.onsort.call(this,orderBy)===false||o.$sort.call(this,orderBy)};ECOM_TABLE_CLASS.renderBody=function(html){var outer=this.getOuter(),self=this,tbEl,pgEl;if(this._uTable){this._uTable.setEnabled(false);disposeControl(this._uTable);removeDom(domQuery(".ec-ecom-table-el",outer)[0])}if(this._uPager){this._uPager.setEnabled(false);disposeControl(this._uPager);try{removeDom(domQuery(".ec-ecom-pager-el",outer)[0])}catch(e){}}each(children(outer),function(n,i){if(n!=self._eMask){removeDom(n)}});insertHTML(this._eMask,"afterEnd",html);tbEl=domQuery(".ec-ecom-table-el",outer)[0];pgEl=domQuery(".ec-ecom-pager-el",outer)[0];if(tbEl){this._uTable=$fastCreate(ECOM_TABLE_BODY,tbEl,this,getParameters(tbEl));this._uTable.cache();this._uTable.init()}if(pgEl){this._uPager=$fastCreate(ECOM_PAGER,pgEl,this,getParameters(pgEl));this._uPager.cache();this._uPager.init()}this.resize()};ECOM_TABLE_BODY_CLASS.getChecked=function(){var ret=[];try{var col=this.getCol(0),cbs=core.get("cball_"+this.getParent()._nTbId),cbs=(cbs instanceof core.ui.Checkbox)?cbs:core.query({parent:cbs})[0],cbs=cbs.getInferiors(),i=cbs.length;while(i--){if(cbs[i].isChecked()){ret.push(cbs[i].getParent())}}}catch(e){}return ret};ECOM_TABLE_BODY_CLASS.getCheckedCount=function(){return this.getChecked().length};ECOM_TABLE_BODY_CLASS.getCheckedStr=function(name){var ret=[];try{this.eachRow(function(n,i,cb){if(cb&&cb.isChecked()){ret.push([name||cb.getName(),cb.getValue()].join("="))}})}catch(e){}return ret.length>0?ret.join("&"):""};ECOM_TABLE_BODY_CLASS.setMsg=function(msg){var msgBox=lib.dom.g("tbMsg_"+this.getParent()._nTbId);dom.setText(msgBox,msg);return msgBox};ECOM_TABLE_BODY_CLASS.eachRow=function(func){each(this._aRow,function(n,i){var checkbox=n._cCheckbox;func&&func.call(n,n,i,checkbox)})};ECOM_TABLE_BODY_CLASS.checkRows=function(func){this.eachRow(function(n,i,checkbox){checkbox.setChecked(false);if(func&&func.call(n,n,i,checkbox)){checkbox.setChecked(true)}})};ECOM_TABLE_BODY_CLASS.isEmpty=function(){return this._bNoData};(function(){var methodNames=["getChecked","getCheckedCount","getCheckedStr","isEmpty","eachRow","checkRows"];for(var i=0,o;o=methodNames[i++];){ECOM_TABLE_CLASS[o]=(function(){var method=o;return function(){var t=this._uTable;return t[method].apply(t,arguments)}})()}})();ECOM_PAGER_CLASS.onpageset=function(pageNum){var parent=this.getParent(),pageParam=parent._sPageParam,pageUrl=""+parent._sPageUrl,pageProps=[pageParam,pageNum].join("="),data=ASYNCSTATEMGR.getCurState("lst_"+parent._nTbId);if(parent._uTable._bSyncOp){parent.setLocked(true);location.href=document.forms.query.action+"?"+pageParam+"="+pageNum;return }if(parent._sOrderByVal){pageProps+="&"+[[parent._sOrderByParam,parent._sOrderByVal].join("="),[parent._sDescParam,parent._bDesc].join("=")].join("&")}pageProps+="&urlType=page";data=ECOM_TABLE_SETTBSTATE(parent,data,pageProps);parent.post(pageUrl,{data:data});return false};ECOM_TABLE_CLASS.setLocked=function(lock,msg){if(lock){this.lock(msg);(CLICKSHIELD)&&(CLICKSHIELD.lock(this))}else{this.unlock();(CLICKSHIELD)&&(CLICKSHIELD.unlock(this))}};ECOM_TABLE_CLASS.lock=function(msg){var mask=this._eMask,msg=msg||"请稍候...",outer=this.getOuter(),height,lineHeight;height=Math.max(outer.offsetHeight,100);lineHeight=Math.min(height,getScrollTop()+getViewHeight()-Math.min(outer.offsetTop,getScrollTop()));setStyles(mask,{width:outer.offsetWidth,height:height+"px",lineHeight:lineHeight+"px",display:"block"});setStyles(outer,{height:height+"px"});setText(mask.getElementsByTagName("span")[0],msg)};ECOM_TABLE_CLASS.unlock=function(msg){var mask=this._eMask,outer=this.getOuter();mask.style.display="none";document.body.offsetWidth;outer.style.height="";document.body.offsetWidth;outer.className+=""};UI_TABLE_CLASS.removeRows=function(){this.paint=blank;for(var i=0,len=this.getRows().length;i<len;i++){try{this.removeRow(0)}catch(e){}}delete this.paint;this.paint()};UI_TABLE_CLASS.addRows=function(data){this.paint=blank;for(var i=0,o;o=data[i++];){o!==undefined&&this.addRow(o)}delete this.paint;this.paint()};UI_TABLE_CLASS.update=function(data){this.removeRows();this.addRows(data)};ECOM_TABLE_CLASS.getCellHTML=function(x,y){var ret="";try{ret=this._uTable.getRows()[x].getCols()[y].getOuter()}catch(e){throw new Error("没有找到单元格")}ret=ret.getElementsByTagName("div")[0].innerHTML;return ret};ECOM_TABLE_CLASS.getRowCount=function(){return this._uTable.getRows().length};ECOM_TABLE_CLASS.getHeadData=function(){var ths=this._uTable._uHead.getOuter().getElementsByTagName("th"),ret=[];each(ths,function(n,i){ret.push(getText(n))});return ret};ECOM_TABLE_CLASS.getHeadDataStr=function(){return jsonToStr(this.getHeadData())};ECOM_TABLE_CLASS.getBodyData=function(){var content=this._uTable.getBody().getElementsByTagName("table")[0],rows=content.rows,ret=[];for(var i=0,o;o=rows[i];i++){ret.push([]);o=o.cells;for(var j=0,p;p=o[j++];){ret[i].push(getText(p))}}return ret};ECOM_TABLE_CLASS.getBodyDataStr=function(){return jsonToStr(this.getBodyDataStr())};var ASYNCMGR=ECOM_TABLE.AsyncMgr=function(){},ASYNCMGR_CLASS=ASYNCMGR.prototype,callbackNames=["success","error"];ASYNCMGR_CLASS.post=function(ecId,url,options){var control=typeof ecId=="string"?core.get(ecId):ecId,options=options||{},newUrl,newData,o={},self=this;if(this.beforePost){o=this.beforePost(control,url,options)}newUrl=o.url||url;newData=o.data||options.data||"";request(newUrl,{method:"POST",async:true,data:newData+"&feReqTime="+new Date().getTime(),onsuccess:(function(){return function(xhr,res){self.success.call(self,control,xhr,res,{url:url,data:options.data||{}})}})(),onfailure:(function(){return function(xhr,res){self.error.call(self,control,xhr,res)}})()});return this};ASYNCMGR_CLASS.$success=function(control,xhr,res,reqInfo){var o;try{var data=trim(res).replace(/\$tbId/g,control._nTbId)}catch(e){alert(["JSON数据解析错误",e.name,e.message].join("\n"));control.setLocked(false);return }data!=""&&control.renderBody(data);control.setLocked(false);o=queryToJson(ECOM_TABLE_GETTBSTATE(control,reqInfo.data));if(o[control._sOrderByParam]){control._sOrderByVal=o[control._sOrderByParam];control._bDesc=eval(o[control._sDescParam])}};ASYNCMGR_CLASS.$error=function(control,xhr,res){alert(["请求错误, 请稍后重试","状态码: "+xhr.status,"信息: "+xhr.statusText].join("\n"));control.setLocked(false)};(function(){for(var i=0,o;o=callbackNames[i++];){ASYNCMGR_CLASS[o]=new Function("control","xhr","res","reqInfo","var o=this;o.on"+o+"&&o.on"+o+".call(o, control, xhr, res, reqInfo)===false||o.$"+o+".call(o, control, xhr, res, reqInfo)")}})();ecomui.getTable=function(name){if(typeof name=="string"){return core.get(str)}else{if(typeof name=="number"){return core.query({type:ui.EcomTable})[name]||null}else{return core.query({type:ui.EcomTable})[0]||null}}}})();