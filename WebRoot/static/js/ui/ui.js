var asynMgr=function(){var config_={CONTROL_IFRAME_ID:"iframeRecorder",CONTROL_IFRAME_URL:"",CONTROL_Input_ID:"inputRecorder",URL_STORAGE_LENGTH:2083,SERVER_GETTER_URL:"",SERVER_SETTER_URL:""},asynRelation_=[],repaintByMe_=false,dataStorage_,urlDataStorage_,serverDataStorage_,areaStateMgr_,formAreaStateMgr_;dataStorage_=function(){function saveData(data,options){options=options?options:{};var result=false,mode=options.mode||"url";dataForStorage={id:(Math.random()+"").substring(5,13),data:data};options.mode=options.mode||"url";options.duration=options.duration||86400;options.replace=options.replace===true?true:false;try{result=eval(mode+"DataStorage_").saveData(dataForStorage,options)}catch(e){}return result}function getData(id,mode,key){var result=rigel.isString(key)?"":{};mode=mode||"url";try{result=eval(mode+"DataStorage_").getData(id,mode,key)}catch(e){}return result}function getDataByUrl(key){return dataStorage_.getData("",null,key)}function saveDataByUrl(data,replace){var options={mode:"url",replace:replace===true?true:false};return dataStorage_.saveData(data,options)}function getSpecifyData(data,key){var result=rigel.isString(key)?"":{};if(rigel.isString(key)){result=data.data[key]||""}else{if(rigel.isArray(key)){for(var i=0,len=key.length;i<len;i++){var item=key[i];result[item]=data.data[item]}}else{result=data}}return result}return{saveData:saveData,getData:getData,getDataByUrl:getDataByUrl,saveDataByUrl:saveDataByUrl,getSpecifyData:getSpecifyData}}();urlDataStorage_=function(){var enabled_=false,shouldEnable_=false,docLoaded_=false,lastToken_="",timer_=null,unsetIframe_=true,hiddenIframe_,hiddenInput_,iframeSrc_=config_.CONTROL_IFRAME_URL,baseUrl_=window.location.href.split("#")[0]+"#",onHashChange_=function(e){var hash=getHash_(window);update_(hash)};var HAS_ONHASHCHANGE_=rigel.isIE&&document.documentMode>=8,INPUT_TEMPLATE_='<input type="text" name="#{0}" id="#{1}" style="display:none" />',IFRAME_TEMPLATE_='<iframe id="#{0}" style="display:none" #{1}></iframe>';function initRecorderIframe_(iframeInPage){if(HAS_ONHASHCHANGE_){return null}if(iframeInPage){hiddenIframe_=iframeInPage}else{if(rigel.isIE&&!iframeSrc_){iframeSrc_=window.location.protocol=="https"?"https:///":'javascript:""'}var srcAttribute=iframeSrc_?'src="'+rigel.string.encodeHTML(iframeSrc_)+'"':"",iframeId=config_.CONTROL_IFRAME_ID;document.write(rigel.string.format(IFRAME_TEMPLATE_,iframeId,srcAttribute));hiddenIframe_=rigel.g(iframeId)}return hiddenIframe_}function initRecorderInput_(inputInPage){if(inputInPage){hiddenInput_=inputInPage}else{var inputId=config_.CONTROL_Input_ID;document.write(rigel.string.format(INPUT_TEMPLATE_,inputId,inputId));hiddenInput_=rigel.g(inputId)}return hiddenInput_}function init(inputInPage,iframeInPage){initRecorderInput_(inputInPage);initRecorderIframe_(iframeInPage);if(rigel.isIE&&!HAS_ONHASHCHANGE_){rigel.domReady(function(){docLoaded_=true;if(hiddenInput_.value){setIframeToken_(hiddenInput_.value,true)}setEnabled(shouldEnable_)})}setHash_(getToken(),true);setEnabled(true)}function setEnabled(enabled){if(enabled==enabled_){return }if(rigel.isIE&&!HAS_ONHASHCHANGE_&&!docLoaded_){shouldEnable_=enabled;return }if(enabled){if(HAS_ONHASHCHANGE_){baidu.on(window,"hashchange",onHashChange_)}else{if(!rigel.isIE||docLoaded_){lastToken_=!rigel.isIE?getToken():lastToken_;timer_=setInterval(poll_,150)}}enabled_=true;if(arguments.callee.hasCalled){window.navCallback_&&window.navCallback_(getToken())}else{arguments.callee.hasCalled=true}}else{enabled_=false;baidu.un(window,"hashchange",onHashChange_);clearInterval(timer_)}}function update_(token){lastToken_=hiddenInput_.value=token;setHash_(token);if(rigel.isIE&&!HAS_ONHASHCHANGE_){setIframeToken_(token)}if(arguments.callee.hasCalled){window.navCallback_&&window.navCallback_(getToken())}else{arguments.callee.hasCalled=true}}function poll_(){var hash=getHash_(window);if(hash!=lastToken_){update_(hash)}if(rigel.isIE&&!HAS_ONHASHCHANGE_){var token=getIframeToken_()||"";if(token!=lastToken_){update_(token)}}}function getToken(){return getHash_(window)}function getHash_(w){var loc=w.location.href;var index=loc.indexOf("#");return index<0?"":loc.substring(index+1)}function getIframeToken_(){var iframeWindow=hiddenIframe_.contentWindow;if(rigel.isIE){var doc=iframeWindow.document;return doc.body?decodeURIComponent(doc.body.innerHTML):""}else{if(iframeWindow){var hash;try{hash=decodeURIComponent(getHash_(iframeWindow))}catch(e){}return hash||""}else{return""}}}function setToken(token,title){setHistoryState_(token,false,title)}function replaceToken(token,title){setHistoryState_(token,true,title)}function setHistoryState_(token,replace,title){if(getToken()!=token){setHash_(token,replace);if(!HAS_ONHASHCHANGE_){if(rigel.isIE){setIframeToken_(token,replace,title)}if(enabled_){poll_()}}}}function setHash_(hash,replace){var url=baseUrl_+(hash||""),loc=window.location;if(url!=loc.href){if(replace){loc.replace(url)}else{loc.href=url}}}function setIframeToken_(token,replace,title){if(unsetIframe_||token!=getIframeToken_()){unsetIframe_=false;token=encodeURIComponent(token);var iframeWindow=hiddenIframe_.contentWindow;if(rigel.isIE){var doc=iframeWindow.document;title=rigel.string.encodeHTML(title||window.document.title);doc.open("text/html",replace?"replace":undefined);doc.write("<title>"+title+"</title><body>"+token+"</body>");doc.close()}else{var url=iframeSrc_+"#"+token;if(iframeWindow){if(replace){iframeWindow.location.replace(url)}else{iframeWindow.location.href=url}}}}}function saveData(data,options){var replace=options.replace===true?true:false;var storedData=dataStorage_.getDataByUrl(),count=storedData.count||0;if(rigel.json.stringify(storedData.data)==rigel.json.stringify(data.data)){return false}data.mode="url";count++;data.count=count;var strData=rigel.json.stringify(data);var url=baseUrl_+strData;if(url.length>config_.URL_STORAGE_LENGTH){data.mode="server";serverDataStorage_.saveData(data,{mode:"server"});delete data.data;strData=rigel.json.stringify(data)}setToken(strData,replace);return data.id}function getData(id,mode,key){var result=rigel.isString(key)?"":{},storedDataStr=getToken(),storedDataObj={};if(!storedDataStr){return result}storedDataStr=rigel.isIE?storedDataStr:decodeURIComponent(storedDataStr);storedDataObj=rigel.json.parse(storedDataStr)||{};if(storedDataObj.mode=="server"){id=storedDataObj.id;return serverDataStorage_.getData(id,"server",key)}result=dataStorage_.getSpecifyData(storedDataObj,key);return result}return{init:init,getToken:getToken,setToken:setToken,setEnabled:setEnabled,replaceToken:replaceToken,saveData:saveData,getData:getData}}();serverDataStorage_=function(){function saveData(data,options){data.mode="server";var id=data.id,duration=options.duration?options.duration:86400,strData=encodeURIComponent(rigel.json.stringify(data)),params="id="+id+"&data="+strData+"&duration="+duration;rigel.ajax.request(config_.SERVER_SETTER_URL,{method:"POST",async:false,noCache:true,data:params})}function getData(id,mode,key){var result=baidu.isString(key)?"":{},params="id="+id;rigel.ajax.request(config_.SERVER_SETTER_URL,{method:"GET",async:false,noCache:false,data:params,onsuccess:function(xhr,responseText){var data=rigel.json.parse(responseText)||{};result=dataStorage_.getSpecifyData(data,key)}});return result}return{saveData:saveData,getData:getData}}();areaStateMgr_=function(){function set(id,stateData,type){type=type||"form";try{eval(type+"AreaStateMgr_").set(id,stateData)}catch(e){}}function get(id,type){type=type||"form";var ret="";try{ret=eval(type+"AreaStateMgr_").get(id)}catch(e){}return ret}return{get:get,set:set}}();formAreaStateMgr_=function(){function set(id,stateData){var queryObj=rigel.url.queryToJson(stateData),form=rigel.g(id),item,oItem,i,len,opts,itemName,itemType,itemValue,itemArr,itemValueArr;queryObj=decodeKeywordInJson_(queryObj);for(itemName in queryObj){item=form[itemName.replace(/_$/,"")];if(item){itemValue=queryObj[itemName];itemArr=item.nodeType==1?[item]:item;itemValueArr=rigel.isArray(itemValue)?itemValue:[itemValue];itemType=itemArr[0].type;switch(itemType){case"textarea":case"text":case"password":case"hidden":case"select-one":for(i=0,len=itemValueArr.length;i<len;i++){if(!itemArr[i]){continue}itemArr[i].value=itemValueArr[i]}break;case"radio":for(i=0,len=itemArr.length;i<len;i++){if(itemArr[i].value==itemValueArr[0]){itemArr[i].checked=true;break}}break;case"checkbox":for(i=0,len=itemArr.length;i<len;i++){if(rigel.array.indexOf(itemValueArr,itemArr[i].value)!=-1){itemArr[i].checked=true}else{itemArr[i].checked=false}}break;case"select-multiple":opts=itemArr[0].options;len=opts.length;for(i=0;i<len;i++){oItem=opts[i];if(rigel.array.indexOf(itemValueArr,oItem.value)!=-1){oItem.selected=true}else{oItem.selected=false}}break;default:break}}}form.onSetting&&form.onSetting(queryObj);form=null}function get(id){var form=rigel.g(id),elements=form.elements,len=elements.length,replacer=function(value,name){return value},data=[],i,item,itemType,itemName,itemValue,opts,oi,oLen,oItem;function addData(name,value){value=encodeKeyword_?encodeKeyword_(value):value;data.push(name+"="+value)}for(i=0;i<len;i++){item=elements[i];itemName=item.name;dataShield=item.getAttribute("data-shield");if(!item.disabled&&itemName){itemType=item.type;itemValue=item.value;itemName=dataShield?itemName+"_":itemName;switch(itemType){case"radio":case"checkbox":if(!item.checked){break}case"textarea":case"text":case"password":case"hidden":case"select-one":addData(itemName,replacer(itemValue,itemName));break;case"select-multiple":opts=item.options;oLen=opts.length;for(oi=0;oi<oLen;oi++){oItem=opts[oi];if(oItem.selected){addData(itemName,replacer(oItem.value,itemName))}}break;default:break}}}form=null;return data.join("&")}function encodeKeyword_(data){data=data||"";data=data.replace(/\&/g,"~1~");data=data.replace(/\=/g,"~2~");return data}function decodeKeyword_(data){data=data||"";data=data.replace(/\~1\~/g,"&");data=data.replace(/\~2\~/g,"=");return data}function decodeKeywordInJson_(queryJson){var retJson={},name,value,i,len;for(name in queryJson){value=queryJson[name];if(rigel.isString(value)){value=decodeKeyword_(value)}else{for(i=0,len=value.length;i<len;i++){value[i]=decodeKeyword_(value[i])}}retJson[name]=value}return retJson}return{get:get,set:set}}();filterAreaStateMgr_=function(){function set(id,stateData){var filterAreaEl=rigel.g(id),itemEls=filterAreaEl.getElementsByTagName("input"),i,len,itemEl,value;value=stateData.split("=")[1];for(i=0,len=itemEls.length;i<len;i++){itemEl=itemEls[i];if(itemEl.value==value){itemEl.checked=true;break}}}function get(id){var filterAreaEl=rigel.g(id),itemEls=filterAreaEl.getElementsByTagName("input"),i,len,itemEl,ret,name,value;for(i=0,len=itemEls.length;i<len;i++){itemEl=itemEls[i];if(itemEl.checked){name=itemEl.name;value=itemEl.value;ret=name+"="+value;break}}return ret}return{get:get,set:set}}();function convertToUrl(objQueryData){var ret=[],retStr,dataStr;for(var o in objQueryData){dataStr=objQueryData[o];if(dataStr){dataStr=dataStr.replace(/&?[^&=]+_=[^&=]*/g,"").replace(/^&/,"");dataStr=dataStr.replace(/\&/g,"(*1*)").replace(/\=/g,"(*2*)");dataStr=dataStr.replace(/\~1\~/g,"&").replace(/\~2\~/g,"=");dataStr=encodeURIComponent(dataStr);dataStr=dataStr.replace(/\(\*1\*\)/g,"&").replace(/\(\*2\*\)/g,"=");ret.push(dataStr)}}retStr=ret.join("&");return retStr}function isOn_(){return getAsynRelation_().length>0}function hasStore_(){return !!dataStorage_.getDataByUrl()["id"]}function setRepaintByMe(state){repaintByMe_=state}function getRepaintByMe(){return repaintByMe_}function getAsynRelation_(stateAreaId){var i=0,len=asynRelation_.length;if(!stateAreaId){return asynRelation_}for(;i<len;i++){var relationItem=asynRelation_[i];for(var j=0;j<relationItem.length;j++){var areaItem=relationItem[j];if(areaItem.id===stateAreaId){return relationItem}}}return[]}function initAsynRelation_(){var i=0,len=asynRelation_.length,tempArr=[];for(;i<len;i++){var relationItem=asynRelation_[i];tempArr[i]=[];for(var j=0;j<relationItem.length;j++){tempArr[i][j]={};var areaItem=relationItem[j];var areaItemArr=areaItem.split("#");tempArr[i][j]["type"]=areaItemArr[0];tempArr[i][j]["id"]=areaItemArr[1]}}asynRelation_=tempArr}function repaintTable(stateAreaId){var curAreaId=stateAreaId,curAreaType="",relation=getAsynRelation_(curAreaId),tableAreaId="",otherAreaIdList=[];for(var i=0,len=relation.length;i<len;i++){var item=relation[i];if(item.id==curAreaId){curAreaType=item.type}else{if(item.type=="table"){tableAreaId=item.id}else{otherAreaIdList.push(item.id)}}}var curAreaStateData=areaStateMgr_.get(curAreaId,curAreaType),areaStateData=dataStorage_.getDataByUrl(otherAreaIdList);areaStateData[curAreaId]=curAreaStateData;var tbControl=ecui.get(tableAreaId);tbControl&&tbControl.asynQuery(areaStateData)}function repaintTables(){if(!hasStore_()){return }var relation=getAsynRelation_(),item,itemRelation,hasTb,i,iLen,j,jLen,id,type,tbId,areaIdList,areaStateData;for(i=0,iLen=relation.length;i<iLen;i++){itemRelation=relation[i];hasTb=false;areaIdList=[];for(j=0,jLen=itemRelation.length;j<jLen;j++){item=itemRelation[j];id=item.id;type=item.type;if(type=="table"){hasTb=true;tbId=id}areaIdList.push(id)}if(hasTb){areaStateData=dataStorage_.getDataByUrl(areaIdList);tbControl=ecui.get(tbId);tbControl&&tbControl.recover(areaStateData)}}}function getCurState(stateAreaId){var relation=getAsynRelation_(stateAreaId),areaIdList=[];for(var i=0,len=relation.length;i<len;i++){areaIdList.push(relation[i]["id"])}return dataStorage_.getDataByUrl(areaIdList)}function updateStateData(data,replace){var ret=false;if(rigel.json.stringify(data)=="{}"){return ret}var historyStateData=dataStorage_.getDataByUrl(),stateData=historyStateData.data||{};for(var key in data){stateData[key]=data[key]}setRepaintByMe(false);ret=dataStorage_.saveDataByUrl(stateData,replace);return ret}function backfillState(){if(!isOn_()||!hasStore_()){return }var i=0,len=asynRelation_.length;for(;i<len;i++){var relationItem=asynRelation_[i];for(var j=0;j<relationItem.length;j++){var areaItem=relationItem[j];var stateData=dataStorage_.getDataByUrl(areaItem.id);areaStateMgr_.set(areaItem.id,stateData,areaItem.type)}}}function storeFirstState(){if(!isOn_()||hasStore_()){return }var i=0,j=0,len=asynRelation_.length,relationItem,areaItem,dataItem,data={};for(;i<len;i++){relationItem=asynRelation_[i];for(j=0;j<relationItem.length;j++){areaItem=relationItem[j];dataItem=areaStateMgr_.get(areaItem.id,areaItem.type);if(dataItem){data[areaItem.id]=dataItem}}}updateStateData(data,true)}function init(){urlDataStorage_.init();var callback=function(){},args=arguments,len=args.length;for(var i=0;i<len;i++){if(rigel.isArray(args[i])){asynRelation_.push(args[i])}}initAsynRelation_();if(rigel.isFunction(args[len-1])){callback=args[len-1]}rigel.domReady(function(){backfillState();callback()});if(hasStore_()){setRepaintByMe(true)}window.navCallback_=function(){if(!getRepaintByMe()){setRepaintByMe(true)}else{repaintTables();backfillState()}}}return{dataStorage:dataStorage_,urlDataStorage:urlDataStorage_,repaintTable:repaintTable,repaintTables:repaintTables,backfillState:backfillState,updateStateData:updateStateData,getCurState:getCurState,setRepaintByMe:setRepaintByMe,getRepaintByMe:getRepaintByMe,convertToUrl:convertToUrl,init:init}}();(function(){var core=ecui,dom=core.dom,ui=core.ui,util=core.util,ext=core.ext,lib=baidu,modalForm,$register=core.$register,setStyle=dom.setStyle,createDom=dom.create,removeDom=dom.remove,insertBefore=dom.insertBefore,attachEvent=util.attachEvent,standardEvent=core.event,toArray=lib.lang.toArray,each=lib.array.each,contains=lib.dom.contains,ieVersion=core.browser.ie,_mapList={},_unitList=[],_controls={},_radioCheckedMap={},_POLLINGTIME=2000,EXT_CLICKSHIELD=ext.clickShield={},EXT_CLICKSHIELD_RULES=ruleMethods={};function getUId(el){var id;if(typeof (el)!="string"){(el.getUID)&&(id=el.getUID());(!id)&&(id=el.id)}return id?id:el}function getControl(id){return _controls[id]}function getUnitListById(id){return _unitList[_mapList[id]]}function wrapper(el,un){var par,mask,next,checked=null;if(el.type&&(el.type=="radio"||el.type=="checkbox")){next=lib.dom.next(el);if(next.tagName!="LABEL"||next.htmlFor!=el.id){next=null}(ieVersion<=7)&&(el.defaultChecked=el.checked)}if(un){el.className=el.className.replace(/\s\bdisabled\b/,"");par=el.parentNode;insertBefore(el,par);(next)&&(insertBefore(next,par));removeDom(par)}else{el.className+=" disabled";par=createDom("","position:relative;display:inline-block","span");mask=createDom("","position:absolute;top:0px;left:0px;_background:#000;_filter:alpha(opacity=0)");par.appendChild(mask);insertBefore(par,el);par.appendChild(el);(next)&&(par.appendChild(next));mask.style.height=par.offsetHeight+"px";mask.style.width=par.offsetWidth+"px"}}function polling(url,callback){lib.ajax.get(url,function(xht,res){res=eval("("+lib.string.trim(res)+")");if(res.isOK=="true"){callback.call(null)}else{setTimeout(function(){polling.call(null,url,callback)},_POLLINGTIME)}})}function maskFixed(un){each(toArray(document.getElementsByTagName("select")),function(n,i){if(un===false&&n.getAttribute("data-maskhide")=="true"){n.style.visibility="visible";n.removeAttribute("data-maskhide")}else{if(n.style.visibility!="hidden"&&!contains(modalForm.getOuter(),n)){n.setAttribute("data-maskhide","true");n.style.visibility="hidden"}}})}function initElement(id,type){var el,ev="click";if(type=="control"){el=(typeof (id)=="string")?_controls[id]:id;(el.onShieldInit)&&(el.onShieldInit())}else{el=(typeof (id)=="string")?document.getElementById(id):id;(el.tagName=="SELECT")&&(ev="change");attachEvent(el,ev,function(e){EXT_CLICKSHIELD.lock(el)})}}EXT_CLICKSHIELD.lock=function(id,un){var id=getUId(id),list=getUnitListById(id);if(list.lock===!un){return }else{list.lock=!un}for(var i=0,item;item=list[i];i++){EXT_CLICKSHIELD_RULES[item.type+"Lock"](item.id,un)}};EXT_CLICKSHIELD.unlock=function(id){this.lock(id,true)};EXT_CLICKSHIELD.register=function(id,type,unitIndex,config){var list,o={},obj;if(type=="control"){obj=(typeof (id)=="string")?core.get(id):id}id=getUId(id);if(unitIndex||unitIndex==0){list=_unitList[unitIndex]}else{list=[];list.lock=false;_unitList.push(list);unitIndex=_unitList.length-1}o.id=id;o.type=type;list.push(o);if(type=="control"){_controls[id]=obj}_mapList[id]=unitIndex;return unitIndex};EXT_CLICKSHIELD.auto=function(id,type,unitIndex,config){var idx=EXT_CLICKSHIELD.register(id,type,unitIndex,config);initElement(id,type);return idx};EXT_CLICKSHIELD.load=function(list,unitIndex){for(var i=0,item;item=list[i];i++){unitIndex=EXT_CLICKSHIELD.register(item.id,item.type,unitIndex)}return unitIndex};EXT_CLICKSHIELD_RULES.simpleLock=function(id,un){var el=document.getElementById(id),tag=el.tagName;if(tag=="INPUT"&&"submit|button".indexOf(el.type.toLowerCase())>=0){el.disabled=!(un==true)}else{if(ieVersion<=6&&tag=="SELECT"){if(un){setStyle(el,"visibility","visible")}else{setStyle(el,"visibility","hidden")}}else{wrapper(el,un)}}};EXT_CLICKSHIELD_RULES.controlLock=function(id,un){var control=_controls[id];if(un){(control.unlock)&&(control.unlock())}else{(control.lock)&&(control.lock())}};EXT_CLICKSHIELD_RULES.downloadLock=function(id,un){var el;if(!modalForm){el=createDom("floater","width:200px;height:50px;position:absolute");el.innerHTML='<label>提示</label><div class="floater-content"><div class="floater-inner">正在下载，请稍候...</div></div>';document.body.appendChild(el);modalForm=ecui.create("form",{element:el});modalForm.$getSection("Close").hide()}if(un){modalForm.hide()}else{modalForm.showModal();modalForm.center();(ieVersion<7)&&(maskFixed())}el=document.getElementById(id).getAttribute("rel");if(!el||un){return }setTimeout(function(){polling.call(null,el,function(){EXT_CLICKSHIELD.unlock(id)})},_POLLINGTIME)};$register("shield",function(el,params){var pars,idx;params.replace(/([A-Za-z0-9\-]+)\s*\(\s*([^)]+)\)/,function($0,$1,$2){pars=$2.split(/\s+/);idx=_mapList[pars[0]];if(pars[1]=="true"){idx=EXT_CLICKSHIELD.auto(el,$1,idx)}else{idx=EXT_CLICKSHIELD.register(el,$1,idx)}(!_mapList[pars[0]])&&(_mapList[pars[0]]=idx)})});(rigel)&&(rigel.clickShield=EXT_CLICKSHIELD)})();var ecomui=ecomui||{};(function(){var D=baidu,E=ecui,Q=E.dom,AU=D.dom,l=E.ui,AK=E.util,d=E.browser.ie,AH=E.$fastCreate,AD=Q.create,AS=AK.blank||function(){},AI=AK.inherits,S=AK.copy,k=D.dom.g,P=D.dom.insertAfter,y=E.string.toCamelCase,AE=E.get,j=E.query,AM=D.string.trim,L=AU.setStyles,AG=Q.children,Ae=Q.insertHTML,Y=Q.setText,b=D.object.clone,AC=Q.getStyle,AZ=D.date,X=AZ.format,z=AZ.parse,N="((\\d{4})-(\\d{1,2})-(\\d{1,2})?)",AW=new RegExp("^"+N+"$"),AJ=new RegExp("^"+N+"\\s+至\\s+"+N+"$"),V=new RegExp("^"+N+"\\s+(之(?:前|后))$"),B=/^\d{4}-\d{1,2}(-\d{1,2})?$/,W=Math.min,t=Math.max,n=AK.getView,v=l.Control,F=v.prototype,I=l.Calendar,Z=l.Select,AR=Z.prototype,AA=l.Edit,AO=AA.prototype,U,AB,i,o=(function(){var g=new Date();return{year:g.getFullYear(),month:g.getMonth(),range:"5y-5y",selectedDate:null}})(),M="yyyy-MM-dd",O=["range","month","year","selectedDate"],m=ecomui.EcomCalendar=l.EcomCalendar=function(Ag,Ah){v.call(this,Ag,Ah);var g=this.getBody(),Af;g.innerHTML='<div class="date-content-sel"><table><tr>                <td><div class="prev month-nav"></div></td>                <td><select class="ec-select year-select"></select></td><td><span class="text-label">年</span></td>                <td><select class="ec-select month-select">$monthOptions</select></td><td><span class="text-label">月</span></td>                <td><div class="next month-nav"></div></td>                </tr></table></div>            <div class="ec-calendar ec-calendar"></div>';Af=g.firstChild.getElementsByTagName("td");this.setClass("time-single");this._oInitProps=this.setProps(Ah);this._uCalGrid=AH(AP,g.lastChild,this);this._uYearSelect=Af[1].firstChild;this._uMonthSelect=Af[3].firstChild;this._uPrev=AH(u,Af[0].firstChild,this,{category:"prev"});this._uNext=AH(u,Af[5].firstChild,this,{category:"next"});this._uYearSelect._cWrapper=this._uMonthSelect._cWrapper=this;this._uYearSelect.onchange=this._uMonthSelect.onchange=a;this._uCalGrid.ondateclick=Ab},U=AI(m,v),AP=function(g,Af){I.call(this,g,Af)},T=AI(AP,I),u=function(g,Af){v.call(this,g,Af)},p=AI(u,v),AQ=function(Ag,Ai){var Ah=this._sCategory=Ai.category,Af=[];Z.call(this,Ag,Ai);if(Ah=="month"){for(var g=1;g<13;g++){this.append(g+"")}}},c=AI(AQ,Z),R=(function(){}).prototype;U.$cache=function(g,Af){F.$cache.call(this,g,Af);this._uCalGrid.cache()};U.$setSize=AS;U.$init=function(){F.$init.call(this);this._uCalGrid.init();var Ah=this._uYearSelect,g=this._uMonthSelect,Af=A(this.$cal$range);q(Ah,Af);for(var Ag=1;Ag<13;Ag++){try{g.add(new Option(Ag,Ag),null)}catch(Ai){g.add(new Option(Ag,Ag))}}this.change()};function q(g,Af){g.innerHTML="";for(var Ai=Af.from.getFullYear(),Ag=Af.to.getFullYear();Ai<=Ag;Ai++){try{g.add(new Option(Ai,Ai),null)}catch(Ah){g.add(new Option(Ai,Ai))}}}U.setProps=function(Af){var Ah=O,g={},Ai,Ag=0,Aj;for(;Aj=Ah[Ag++];){Ai=Af[Aj]!==undefined?Af[Aj]:this["$cal$"+Aj]!==undefined?this["$cal$"+Aj]:o[Aj];this["$cal$"+Aj]=Ai;g[Aj]=Ai}return g};R.reset=function(){var g=this.$getSection("Calendar");thisYear=g.getYear();thisMonth=g.getMonth();dayCount=new Date(thisYear,thisMonth,0).getDate();this.foreachDate(function(Ah,Ag){var Af=new Date(thisYear,thisMonth-1,Ah._nDay);if(Ah._nDay>0&&Ah._nDay<dayCount+1){Ah.setEnabled(true)}});this._oSelectedDate=null;if(!this.onreset||this.onreset(this._oSettings)!=false){if(this._selectedDateGrid){this._selectedDateGrid.alterClass("selected",true);this._selectedDateGrid=null}}};U.foreachDate=function(Ah){var g=this._uCalGrid._uDate,Af=0,Ag;for(;Ag=g.getItem(Af++);){if(Ag){Ah.call(Ag,Ag,Af)}}};function A(Ah){var Ah=Ah+"",Af="(\\d{4}\\d{2}\\d{2}|now|\\d+(?:y|m))?",Am=new RegExp(Af+"-"+Af),Ag=Ah.match(Am),Ak=Ag[1],Aj=Ag[2],g=new Date();g=new Date(g.getFullYear(),g.getMonth(),g.getDate());function Ai(Aq){var Ap=/((\d{4})(\d{2})(\d{2}))|(now)/,Ao=Aq,An=Aq&&Aq.match(Ap);if(An){An[1]&&(Ao=new Date(An[2],An[3]-1,An[4]));An[5]&&(Ao=g)}return Ao}function Al(An,Av,Au){var Aw=/(\d+)(y|m)/,Ar,As,Ap,At,Ao,Aq;Aq=Av||"5y";Ar=Aq.match(Aw);if(Ar){As=parseInt(Ar[1]);As=Au?-As:As;Ap=An.getMonth();At=An.getFullYear();Ao=new Date(An);Ar[2]=="y"?Ao=(As>0)?new Date(At+As,11,31):new Date(At+As,0,1):Ao=(As>0)?new Date(At,Ap+As+1,0):new Date(At,Ap+As,1)}return Ao}Ak=Ai(Ak);Aj=Ai(Aj);if(!(Ak instanceof Date)&&Aj instanceof Date){Ak=Al(Aj,Ak,true)}if(!(Aj instanceof Date)&&Ak instanceof Date){Aj=Al(Ak,Aj)}if(!(Ak instanceof Date)&&!(Aj instanceof Date)){Ak=Al(g,Ak,true);Aj=Al(g,Aj)}return{from:Ak,to:Aj}}U.showRange=function(){var Af=A(this.$cal$range),Ah=Af.from,g=Af.to,Al=this._uCalGrid,Ai=this.$cal$year,Ak=this.$cal$month,Aj=new Date(Ai,Ak+1,0).getDate(),Ag=this.$cal$selectedDate;this.foreachDate(function(Ao,An){var Am=new Date(Ai,Ak,Ao._nDay);if(Am<Ah||Am>g){Ao.setEnabled(false)}else{if(Ao._nDay>0&&Ao._nDay<Aj+1){Ao.setEnabled(true)}}})};U.selectDate=function(g){if(g===null){this.setProps({selectedDate:g})}else{if(g.getFullYear){this.setProps({year:g.getFullYear(),month:g.getMonth(),selectedDate:g})}}};function Ab(g){var Af=this.getParent();Af.ondateclick.call(Af,g)}U.ondateclick=function(g){this.selectDate(g);this.change()};p.$click=function(){var Ah=this.getParent(),Ag=Ah._uCalGrid,Af=Ah._uPrev,g=Ah._uNext;this==Af?Ag.move(-1):Ag.move(1);Ah.$cal$year=Ag._nYear;Ah.$cal$month=Ag._nMonth;Ah.change()};function a(g){var Af=this._cWrapper;/year/.test(this.className)&&(Af.$cal$year=parseInt(this.value,10));/month/.test(this.className)&&(Af.$cal$month=parseInt(this.value,10)-1);Af.change()}U.$change=function(){var Ai=this._uYearSelect,g=this._uMonthSelect,Aj=this._uPrev,Ah=this._uNext,Al=this._uCalGrid,Ag=this.$cal$year,Ak=this.$cal$month+1,Af=A(this.$cal$range);Ai.onchange=g.onchange=AS;q(Ai,Af);Ai.value=Ag;g.value=Ak;Ai.onchange=g.onchange=a;Al.setDate(Ag,Ak);this.showRange();this.$cal$selectedDate!==undefined&&f(this)};function f(Ak){var Ah=Ak.$cal$selectedDate,Ag=Ak._uCalGrid._uDate;if(Ak._nSelectedIdx!==undefined){Ag.getItem(Ak._nSelectedIdx).alterClass("selected",true)}if(Ah){var Ai=Ah.getFullYear(),Aj=Ah.getMonth(),g=Ah.getDate(),Al,Af;if(Ai==Ak.$cal$year&&Aj==Ak.$cal$month){Al=(new Date(Ai,Aj,0).getDay()+1)%7;Af=Ak._nSelectedIdx=Al+g-1;Ag.getItem(Af).alterClass("selected")}}}var Ac={},J=l.EcomCalendarEdit=function(Ag,Ak){var Aj,Ai,Ah,g,Af,Al=Ak.calType?y("-"+Ak.calType):"Single";Ak.capture=false;Ag.style.cssText=d&&d<8?"display:inline;zoom:1":"display:inline-block";v.call(this,Ag,Ak);this.alterClass(Al.toLowerCase());Ah=this._uEdit=Ag.getElementsByTagName("input")[0];g=this._uClear=AH(v,Aj=AD("ec-ecom-calendar-clear ec-ecom-calendar-clear ec-inline-block","position:absolute;"),this);Ag.appendChild(Aj);if(Ac[Al]){Ai=this._uCalendar=Ac[Al]}else{Ai=this._uCalendar=AH(J[Al],Aj=AD("ec-ecom-calendar ec-ecom-calendar-"+Al.toLowerCase(),"position:absolute;visibility:hidden;z-index:32768"));document.body.appendChild(Aj);Ac[Al]=Ai}if(!J._eIframe){Af=J._eIframe=AD("","position:absolute;z-index:32766;border:0 none;display:none","iframe");Af.frameBorder="0";document.body.appendChild(Af)}Ah.onfocus=AT;Ai.$show=h;Ai.$hide=Ad;Ai.$blur=AV;Ah._cWrapper=this;Ah._cCalendar=Ai;Ai._cWrapper=this;Ai._eEdit=Ah;g.onclick=AX;this._oCalProps=Ai.setProps(Ai.convertParams(Ak));Ai.oneditcreate&&Ai.oneditcreate(Ak)},AF=AI(J,v);AF.paint=function(){AO.paint.call(this);this._uCalendar.paint()};AF.$init=function(){var g=this._uCalendar;F.$init.call(this);if(!g._bInited){g.$init();g.hide();g.getOuter().style.visibility="";g._bInited=true}};AF.$setSize=function(Af,g){F.$setSize.call(this,Af,g)};AF.reset=function(){this._uCalendar.oneditreset&&this._uCalendar.oneditreset.call(this)};AF.setValue=function(){var g=this._uCalendar.setEditValue;g&&g.apply(this,arguments)};AF.clearValue=function(){var g=this._uCalendar.clearEditValue;g&&g.call(this)};function AT(Af){var g=this._cCalendar;g._cWrapper=this._cWrapper;g._eEdit=this;g.show();E.setFocused(g);this.blur()}function h(Ah){this.constructor.prototype.$show.call(this);var Ag=this._cWrapper.getOuter(),Al=Q.getPosition(Ag),g=n(),Ak=this.getOuter().offsetWidth,Af=this.getOuter().offsetHeight,Aj=g.right<Al.left+Ak?Al.left+Ag.offsetWidth-Ak:Al.left,Ai=g.bottom<Al.top+Ag.offsetHeight+Af?Al.top-Af:Al.top+Ag.offsetHeight;this.setPosition(Aj,Ai);L(J._eIframe,{display:"block",width:Ak,height:Af,left:Aj,top:Ai});this.alterProps();this.change()}function Ad(g){this.constructor.prototype.$hide.call(this);J._eIframe.style.display="none"}function AV(g){this.constructor.prototype.$blur.call(this);this.$hide()}function AX(){this.getParent().clearValue()}var C=J.Single=function(g,Af){m.call(this,g,Af);this.ondateclick=G},x=AI(C,m);x.convertParams=function(g){var Af=AM(this._cWrapper._uEdit.value);if(Af&&(Af=z(Af))){g.selectedDate=Af;g.year=Af.getFullYear();g.month=Af.getMonth()}else{g.selectedDate=null;g.year=o.year;g.month=o.month}return g};x.alterProps=function(){var Ah=this._cWrapper,Ag=Ah._oCalProps,Af=AM(Ah._uEdit.value),g=Af?z(Af):null;this.setProps(Ag);this.selectDate(g)};function G(g){var Af=this._cWrapper._oCalProps;this.constructor.prototype.ondateclick.call(this,g);this._eEdit.value=X(g,M);this.hide();Af.selectedDate=g;Af.year=g.getFullYear();Af.month=g.getMonth()}x.oneditreset=function(){this._oCalProps=S({},this._oInitCalProps)};x.setEditValue=function(Af){var Af=AM(Af),g=z(Af);if(g.constructor!==Date||!B.test(Af)&&Af!=""){throw new Error("日期格式错误!");return }else{this._uEdit.value=Af;this._uCalendar.hide()}};x.clearEditValue=function(){x.setEditValue.call(this,"")};var AY=J.Range=function(Ag,Ai){v.call(this,Ag,Ai);var g=this.getBody(),Af,Ah;g.innerHTML='<div class="time-begin"><table><tr>                <td><span class="text-label">起始:</span></td><td><input readonly="readonly" type="text"  class="begin-cal-input ec-edit"/></td>                <td></td>                </tr></table><div class="single-cal"></div></div><div class="time-end"><table><tr>                <td><span class="text-label">结束:</span></td><td><input readonly="readonly" type="text" class="end-cal-input ec-edit"/></td>                <td></td>            </tr></table><div class="single-cal"></div></div>            <button>确定</button><button>取消</button><button style="display:none">重选</button><span class="calendar-error"></span>';Af=g.getElementsByTagName("td");Ah=g.getElementsByTagName("button");this._uBeginText=Af[1].firstChild;this._uEndText=Af[4].firstChild;this._uBeginCal=AH(m,AG(g)[0].lastChild,this);this._uEndCal=AH(m,AG(g)[1].lastChild,this);this._uBeginCal._eText=this._uBeginText,this._uEndCal._eText=this._uEndText,this._uConfirmBtn=Ah[0];this._uCancelBtn=Ah[1];this._uResetBtn=Ah[2];this._uErrorTip=Ah[2].nextSibling;this._uBeginCal._cPeer=this._uEndCal;this._uEndCal._cPeer=this._uBeginCal;this._uConfirmBtn._cWrapper=this;this._uCancelBtn._cWrapper=this;this._uResetBtn._cWrapper=this;this._uBeginCal.selectDate=this._uEndCal.selectDate=Aa;this._uConfirmBtn.onclick=H;this._uCancelBtn.onclick=w;this._uResetBtn.onclick=K;this.onshow=r},AL=AI(AY,v);AL.$setSize=function(Af,g){F.$setSize.call(this,Af,g);this._uBeginCal.setSize();this._uEndCal.setSize()};AL.$init=function(){F.$init.call(this);this._uBeginCal.init();this._uEndCal.init()};AL.oneditcreate=function(Ah){var g=this._cWrapper,Ao=g.getOuter(),Ak=Ao.getElementsByTagName("input"),Al=["Begin","End"],Ag,An,Am;g._bLoose=Ah.loose||false;g._sBeginName=Ah.beginName||"dateFrom";g._sEndName=Ah.endName||"dateTo";g._sBeginVal=Ah.beginVal||"";g._sEndVal=Ah.endVal||"";g._sRange=Ah.range||o.range;if(Ak.length!=3){Ae(Ao,"beforeEnd",'<input type="hidden" name="'+g._sBeginName+'" value="'+g._sBeginVal+'"/><input type="hidden" name="'+g._sEndName+'" value="'+g._sEndVal+'"/>')}Ak=Ao.getElementsByTagName("input"),An=g._uBeginInput=Ak[1];Am=g._uEndInput=Ak[2];g._sBeginVal=AM(An.value)||g._sBeginVal;g._sEndVal=AM(Am.value)||g._sEndVal;g._sBeginVal&&this._uBeginCal.selectDate(z(g._sBeginVal));g._sEndVal&&this._uEndCal.selectDate(z(g._sEndVal));for(var Aj=0,Ag;Ag=Al[Aj++];){for(var Ai=0,Af;Af=O[Ai++];){g._oCalProps["_o"+Ag+"Props"][Af]=this["_u"+Ag+"Cal"]["$cal$"+Af]}}g._oInitCalProps=b(g._oCalProps);g._uEdit.defaultValue=AN(g._uEdit,g._sBeginVal,g._sEndVal)};function r(g){Y(this._uErrorTip,"")}function AN(Ag,g,Af){var Ah="";if(g&&Af){Ah=g+"至"+Af}else{if(g&&!Af){Ah=g+"之后"}else{if(!g&&Af){Ah=Af+"之前"}}}Ag.value=Ah;return Ah}function Aa(g){this.constructor.prototype.selectDate.call(this,g);var Ag=this.getParent(),Af=this==Ag._uBeginCal?"Begin":"End";this._eText.value=g?X(g,M):"";s(this,g);this._cPeer.change()}function s(Aj,Af){var Ai=Aj._cPeer,Ag=Aj==Aj.getParent()._uBeginCal?"Begin":"End",Ah=Aj.$cal$range,g=Ai.$cal$range,Ak;if(Af){Ak=g.split("-");Ak[Ag=="Begin"?0:1]=X(Af,"yyyyMMdd");Ak=Ak.join("-");Ai.$cal$range=Ak}else{Ai.$cal$range=""+Aj.getParent()._cWrapper._oInitCalProps["_o"+(Ag=="Begin"?"End":"Begin")+"Props"].range}}function H(Ag){var Af=this._cWrapper,Ak=Af._cWrapper._oCalProps,An=["Begin","End"],Aj="",Ao="",g=true;if(!Af._cWrapper._bLoose){if(!(Af._uBeginCal.$cal$selectedDate&&Af._uEndCal.$cal$selectedDate)){g=false;Y(Af._uErrorTip,"请选择"+(!Af._uBeginCal.$cal$selectedDate?"开始":"结束")+"时间")}}if(g){for(var Am=0,Ai;Ai=An[Am++];){for(var Al=0,Ah;Ah=O[Al++];){Ak["_o"+Ai+"Props"][Ah]=Af["_u"+Ai+"Cal"]["$cal$"+Ah]}}Aj=Af._cWrapper._uBeginInput.value=Af._uBeginCal.$cal$selectedDate?X(Af._uBeginCal.$cal$selectedDate,M):"";Ao=Af._cWrapper._uEndInput.value=Af._uEndCal.$cal$selectedDate?X(Af._uEndCal.$cal$selectedDate,M):"";AN(Af._cWrapper._uEdit,Aj,Ao);Af.hide()}}function w(g){var Af=this._cWrapper;Af.hide()}function K(Af){var Ag=this._cWrapper,g=Ag._cWrapper;Ag.setProps(g._oInitCalProps);Ag.change()}AL.$change=function(){var g=this._uBeginCal.$cal$selectedDate,Af=this._uEndCal.$cal$selectedDate;this._uBeginCal.change();this._uEndCal.change();if(g!==undefined){g===null?this._uBeginText.value="":(this._uBeginText.value=X(g,M))}if(Af!==undefined){Af===null?this._uEndText.value="":(this._uEndText.value=X(Af,M))}};AL.setProps=function(g){return{_oBeginProps:this._uBeginCal.setProps(g._oBeginProps),_oEndProps:this._uEndCal.setProps(g._oEndProps)}};AL.alterProps=function(){var Al=this._cWrapper,Ak=Al._oCalProps,g=this._uBeginCal,Ag=this._uEndCal,Af=AM(Al._uBeginInput.value),Ah=AM(Al._uEndInput.value),Ai=Af?z(Af):null,Aj=Ah?z(Ah):null;this.setProps(Ak);g.selectDate(Ai);Ag.selectDate(Aj)};AL.convertParams=function(Ag){var Al=this._cWrapper,Af={},Ai=["Begin","End"];for(var Ah=0,Ak;Ak=Ai[Ah++];){Af["_o"+Ak+"Props"]={};for(var g=0,Aj;Aj=O[g++];){if(Aj=="range"){Af["_o"+Ak+"Props"][Aj]=(Ag[y([Ak.toLowerCase(),Aj].join("-"))]||Ag[Aj]||o[Aj])+""}else{Af["_o"+Ak+"Props"][Aj]=Ag[y([Ak.toLowerCase(),Aj].join("-"))]||o[Aj]}}}return Af};AL.setEditValue=function(Ai,Ag){var g=["Begin","End"],Al={};for(var Ah=0,Ak;Ak=g[Ah];Ah++){var Aj=AM(arguments[Ah]),Af=z(Aj);if(Af.constructor!==Date||!B.test(Aj)&&Aj!=""){throw new Error("日期格式错误!");return }else{this["_u"+Ak+"Input"].value=Aj;this._uCalendar.hide();Al[Ak.toLowerCase()]=Aj}}AN(this._uEdit,Al.begin,Al.end)};AL.clearEditValue=function(){var g=this._oInitCalProps;AL.setEditValue.call(this,"","");g._oBeginProps.range=this._sRange;g._oEndProps.range=this._sRange}})();(function(){var D=ecui,M=D.ui,H=D.util,C=void (0),O=D.dom.create,A=H.copy,N=H.inherits,G=D.$connect,F=D.$fastCreate,E=D.getParameters,L=M.Checkbox,B=M.Tree,J=B.prototype;var K=M.CheckTree=function(Q,S){S=A(A({},S),E(Q));B.call(this,Q,S);S.value=Q.getAttribute("value")||S.value;S.checked=Q.getAttribute("checked")||S.checked;(!S.noRelate)&&(this._sSuperior=S.superior);var P=0,R=this._uCheckbox=F(L,Q.insertBefore(O("ec-checkbox "+this.getBaseClass()+"-checkbox"),Q.firstChild),this,S),T=this.getChildTrees();if(!S.noRelate){for(;Q=T[P++];){S=Q._sSuperior;Q=Q._uCheckbox;S===C?Q.setSuperior(R):S!==true&&G(Q,Q.setSuperior,S)}}},I=N(K,B);I.$cache=function(P,Q){J.$cache.call(this,P,Q);this._uCheckbox.cache(true,true)};I.$init=function(){var Q=this.getChildTrees();this._uCheckbox.$init();J.$init.call(this);for(var P=0,R;R=Q[P];P++){R.$init()}};I.isChecked=function(){return this._uCheckbox.isChecked()};I.getChecked=function(){var R=this.getChildTrees(),Q=[];(this.isChecked())&&(Q.push(this));for(var P=0,S;S=R[P];P++){Q=Q.concat(S.getChecked())}return Q};I.getValue=function(){return this._uCheckbox.getValue()};I.setChecked=function(P){this._uCheckbox.setChecked(P)}})();var ecomui=ecomui||{};(function(){var C=ecui,J=baidu,K=C.ui,I=J.page,A=I.getViewWidth,M=I.getViewHeight,N=C.mask,D=J.dom.contains,F=J.lang.toArray,L=J.array.each,G=C.browser.ie,B=J.dom.query,E=K.Form,H=E.prototype;H.showModal=function(O,Q){var O=O||0.3,P=this.getOuter();Q===undefined&&document.body.appendChild(P);this.show();P.style.zIndex=32768;N(O)};H.onhide=function(){if(G<7){L(F(document.getElementsByTagName("select")),function(P,O){if(P.getAttribute("data-maskhide")=="true"){P.style.visibility="visible";P.removeAttribute("data-maskhide")}})}};ecomui.showModal=function(R,O,Q){var P=C.get(R);P.showModal(O,Q);P.center();P.getOuter().style.visibility="";if(G<7){L(F(document.getElementsByTagName("select")),function(T,S){if(T.style.visibility!="hidden"&&!D(P.getOuter(),T)){T.setAttribute("data-maskhide","true");T.style.visibility="hidden"}})}};ecomui.hideModal=function(O){C.get(O).hide()};H.setContent=function(O){B("div.floater-inner",floater.getOuter())[0].innerHTML=O}})();var ecomui=ecomui||{};(function(){var K=baidu,X=ecui,V=X.dom,O=X.ui,B=X.util,L=B.inherits,S=B.copy,J=B.blank,E=V.children,H=V.first,N=V.create,W=V.remove,G=X.$fastCreate,U=V.setText,D=baidu.ajax.request,F=document,I=O.Control,R=I.prototype,A;var Q=ecomui.Foldable=O.Foldable=function(b,d){var f=d.type,i=b.getElementsByTagName("label")[0],h=false,Z=E(b)[0],c=N(f+"-title"),a=(h=(i&&i==H(H(b))))?i.innerHTML:d.title||"",g=N(f+"-handler");b.style.position="relative";b.insertBefore(c,Z);c.innerHTML=a;h&&W(i);c.insertBefore(g,c.firstChild);d.capture=false;I.call(this,b,d);this._bInitFold=d.initFold||false;this._sAsyncUrl=d.asyncUrl;this._uTitle=G(I,c,this);this._uContent=G(I,Z,this,{capture:false});this._uHandler=G(I,g,this._uTitle,{capture:false});this._uTitle["on"+(d.trigger||"click")]=P},A=L(Q,I);A.$init=function(){R.$init.call(this);var Z=this._bInitFold;C.call(this._uTitle,Z);this._bInitFlushed=false;if(Z){this._uContent.getOuter().style.visibility="visible";this._uContent.getOuter().style.position="static"}this._sAsyncUrl&&!this._bAsyncLoaded&&!Z&&M.call(this,this._sAsyncUrl)};function P(){var Z=this.getParent();if(Z._sAsyncUrl&&!Z._bAsyncLoaded&&!Z._bLocked){M.call(Z,Z._sAsyncUrl)}C.call(this)}function C(k){var d=this.getParent(),j=d._uContent,l=d._uHandler,b=l.getBase(),c=k!==undefined?k:j.isShow(),f=d._bInitFlushed;c?j.hide():j.show();b.setAttribute("title",c?"点击展开":"点击折叠");this.alterClass(c?"unfold":"fold");this.alterClass(c?"fold":"unfold",true);if(f===false){if(!c){for(var g=0,Z,a=X.query({parent:j});Z=a[g++];){try{Z.resize()}catch(h){}}}d._bInitFlushed=true}}function M(a){var Z=this;this._bLocked=true;D(a,{method:"POST",data:"feReqTime="+new Date().getTime(),onsuccess:(function(){return function(c,b){T.call(Z,c,b)}})(),onfailure:(function(){return function(c,b){Y.call(Z,c,b)}})()})}function T(b,a){var Z=true;if(Z){this._uContent.getOuter().innerHTML=a;this._bLocked=false;this._bAsyncLoaded=true;this.onloadcsuccess&&this.onloadsuccess(b,a)}else{C(false);alert("异步返回不正确, 请稍后重试.")}}function Y(a,Z){alert(a.status)}A.$setSize=J;A.$resize=J})();var ecomui=ecomui||{};(function(){var f=ecui,S=f.ui,A=f.util,d=f.dom,E=f.browser.ie,O=f.setFocused,L=A.blank,H=f.$fastCreate,Q=d.create,C=d.insertBefore,N=A.inherits,X=A.copy,F=d.children,h=d.getPosition,D=d.getStyle,c=d.setText,B=f.loseFocus,I=S.Control,W=I.prototype,J=S.Edit,g=J.prototype,K=S.Panel,j=K.prototype,i=S.Listbox,G=i.prototype,V=i.Item,Z=V.prototype,R=S.Item,Y=ecomui.MultiSelect=S.MultiSelect=function(l,o){var p=Q(l.className,l.style.cssText),k=l.name||o.name||"",n=l.value||o.value||"",m=o.type;C(p,l);p.innerHTML='<div class="ec-control'+m+'-text"></div><div class="ec-control '+m+'-button" style="position:absolute"></div><input readonly="readonly" disabled="disabled" data-shield="true" name="ms_'+(o.msId||new Date().getTime())+'"/>';p.style.cssText="position:relative;"+(E&&E<8?"display:inline;zoom:1":"display:inline-block");l.className="ec-panel ec-multiselect-options";l.style.position="absolute";l.style.left="0";this._nSize=l.getAttribute("data-size")||o.size||8;this._eInput=p.lastChild;this._initDisabled=o.disabled===true;this._nLBWidth=l.offsetWidth;p.appendChild(l);I.call(this,p,o);this._uListBox=H(U,l,this,{name:o.name})},M=N(Y,I),U=function(m,p){i.call(this,m,p);var k=this.getItems(),l=0,n;for(;n=k[l++];){n.$selectend=T}},b=N(U,i),P=i.Item=function(k,m){R.call(this,k,m);var l;if((l=k.getElementsByTagName("input")[0])&&l.type=="checkbox"){this._eInput=l;this.setSelected(l.checked===true)}else{k.appendChild(this._eInput=setInput(null,m.parent._sName,"hidden")).value=m.value===undefined?getText(k):""+m.value;this.setSelected(!!m.selected)}},a=N(P,R);X(P.prototype,Z);a.setSelected=function(k){if(this._eInput.type=="checkbox"){k=k===undefined?true:k;this.alterClass("selected",!k);this._eInput.checked=k}else{this.alterClass("selected",this._eInput.disabled=k===false)}};a.isSelected=function(){if(this._eInput.type=="checkbox"){return this._eInput.checked}else{return !this._eInput.disabled}};M.$init=function(){W.$init.call(this);var k=this._uListBox;k.init();this._uListBox.getOuter().style.visibility="hidden";this.showSelected();this._eInput.defaultValue=this._eInput.value;if(this._initDisabled){this.setEnabled(false)}};M.$cache=function(k,l){W.$cache.call(this,k,l);this._uListBox.cache(true,true)};M.$resize=L;M.$setSize=function(k,t){W.$setSize.call(this,k,t);var m=this._uListBox,r=m.getItems(),q=r.length,l=r[0],u=m._uVScroll,n=u&&u.isShow()?u.getWidth():0,s=l?parseInt(D(l.getOuter(),"paddingLeft")):0,p=0;if(q<=1){m._uVScroll=false}p=Math.max(k,this._nLBWidth+n+s);m.setSize(p,l?Math.min(q,this._nSize)*l._nHeight:t);m.getOuter().style.top=t+"px";this.getOuter().className+=""};M.$click=function(k){W.$click.call(this,k);var l=this._uListBox;l.show();l.getOuter().style.visibility="";O(l)};b.$show=function(){j.$show.call(this);this.flush()};b.$blur=function(k){G.$blur.call(this,k);this.$hide()};b.flush=function(){var k=this.getItems();for(var l=0,m;m=k[l++];){if(m._eInput.type=="checkbox"){m.setSelected(m._eInput.checked)}else{m.setSelected(!m._eInput.disabled)}}};function T(k){Z.$selectend.call(this,k);this.getParent().getParent().showSelected()}M.showSelected=function(){var l=this._uListBox.getSelected(),k=0,n,m=[];for(;n=l[k++];){m.push(n.getOuter().firstChild.nodeValue)}this._eInput.value=m.join(",")};M.setEnabled=function(k){W.setEnabled.call(this,k);var n=this._uListBox.getItems();for(var l=0,m;m=n[l++];){m._eInput&&(m._eInput.disabled=k!==true)}};M.getSelected=function(){return this._uListBox.getSelected()}})();var ecomui=ecomui||{};(function(){var M=baidu,b=ecui,Z=b.dom,U=M.dom,T=b.ui,A=b.util,O=A.inherits,V=A.copy,L=A.blank,a=U.g,E=Z.children,R=Z.create,G=b.$fastCreate,Y=Z.setText,c=b.string.toCamelCase,W=b.string.trim,Q=Math,C=Q.ceil,F=document,I=T.Control,S=T.Item,P=T.Items,B=S.prototype,X=["curPage","pageSize","total"],K=ecomui.Pager=T.Pager=function(g,k){var h=[],l=k.bind,j;this.setProps(k);l&&(this._cBind=(typeof l=="string"?b.get(l):l));I.call(this,g,k);h.push('<div class="ec-page-body">');h.push('<div class="ec-pager-first">首页</div><div class="ec-pager-prev">上一页</div>');var d=this.$getPageNumRange(),i=d[0],f=d[1];for(;i<=f;i++){h.push('<div class="page-num">'+i+"</div>")}h.push('<div class="ec-pager-next">下一页</div><div class="ec-pager-last">尾页</div>');h.push("</div>");g.innerHTML=h.join("");this._eBody=g.firstChild;this.$initItems();j=this._uGoOp=R("ec-pager-go","","span");j.innerHTML='<input class="ec-pager-input" type="text" style="width:25px" /><button type="button" class="ec-pager-button">转到</button>';this._uGoInput=j.firstChild;(this._uGoBtn=j.lastChild)._cInput=this._uGoInput;this._uGoBtn._cWrapper=this;g.appendChild(j);j=R("ec-pager-summary","","span");j.innerHTML="<span>共<em></em>页, <em></em>条记录</span><span style='display:none'>不存在记录</span>";this._uSummaryText=j.firstChild;this._uNoRecText=j.lastChild;g.appendChild(j);j=this.getItems();this._uFirst=j[0];this._uLast=j[j.length-1];this._uPrev=j[1];this._uNext=j[j.length-2];this._uGoBtn.onclick=H;this.refresh()},D=O(K,I),J=K.Item=function(f,g){S.call(this,f,g);var d=Math.max(this.getWidth(),25);this.setSize(d)},N=O(J,S);D.$setSize=L;D.$getPageNumRange=function(){var i=this._nCurPage,g=this._nPageSize,h=this._nTotal,f=C(h/g),j=1,d=f+0;if(f>11){if(i>5){j=i-5;d=i+5}else{d=11}if(d>f){j=f-10;d=f}}return[j,d]};D.$getPageNumControl=function(){var g=0,f=[],d=this.getItems(),h;for(;h=d[g++];){/page-num/.test(h.getBase().className)&&f.push(h)}return f};D.$eachPageNum=function(g){var f=0,h,d=this.$getPageNumControl();for(;h=d[f++];){g.call(h,h.getBase().innerHTML)}};N.$click=function(h){var i=this.getBase(),f=this.getParent(),g=D.setCurPage,j=f._cBind,d=C(f._nTotal/f._nPageSize);if(/page-num/.test(i.className)){g.call(f,i.innerHTML)}else{if(/first/.test(i.className)){g.call(f,1)}else{if(/last/.test(i.className)){g.call(f,d)}else{if(/prev/.test(i.className)){g.call(f,f._nCurPage-1)}else{if(/next/.test(i.className)){g.call(f,f._nCurPage+1)}}}}}B.$click.call(this,h)};N.click=function(d){var g=this,f=this.getParent();g.$click.call(g,d);g.isEnabled()&&f.onclick&&f.onclick.call(g,d)};D.$alterItems=L;D.setProps=function(f){var d={},g=0,h;for(;h=X[g++];){this["_n"+c("-"+h)]=f[h]!==undefined?parseInt(f[h],10):this["_n"+c("-"+h)]}};D.refresh=function(){if(this._nCurPage&&this._nPageSize&&this._nTotal){this.getBody().style.display="";this._uGoOp.style.display="";this._uSummaryText.style.display="";this._uNoRecText.style.display="none";this.$setCurPage(this._nCurPage);this.setSummary(this._nPageSize,this._nTotal)}else{this.getBody().style.display="none";this._uGoOp.style.display="none";this._uSummaryText.style.display="none";this._uNoRecText.style.display=""}};D.refreshPage=function(d){this.setProps(d);this.refresh()};D.setSummary=function(d,h){var g=this._uSummaryText,f=g.getElementsByTagName("em");Y(f[0],C(h/d));Y(f[1],h)};function H(){var f=parseInt(W(this._cInput.value)),g=this._cWrapper,d=C(g._nTotal/g._nPageSize);if(f&&f>=1&&f<=d){g.setCurPage(f)}else{alert("请输入1到"+d+"之间的数字.");this._cInput.value="";this._cInput.focus()}}D.$setCurPage=function(p){var q=this,p=parseInt(p,10),g=C(this._nTotal/this._nPageSize),l=0,k=0,f,n=this.$getPageNumControl();if(p==-1){p=g;this._nCurPage=g}else{if(p<1){this._nCurPage=1}else{if(p>g){this._nCurPage=g}else{this._nCurPage=p}}}var m=this.$getPageNumRange(),d=m[0],h=m[1];for(l=d;l<=h;){f=n[k];f.getBase().innerHTML=l;if(l==p){f.alterClass("cur");f.setEnabled(false)}else{f.alterClass("cur",true);f.setEnabled(true)}k++;l++}this._uPrev.setEnabled(this._nCurPage!=1);this._uFirst.setEnabled(this._nCurPage!=1);this._uNext.setEnabled(this._nCurPage!=g);this._uLast.setEnabled(this._nCurPage!=g)};D.setCurPage=function(d){var f=this;f.isEnabled()&&f.onpageset&&f.onpageset.call(f,d)===false||f.$setCurPage.call(f,d)};D.getCurPage=function(){return this._nCurPage+0};D.getBind=function(){return this._cBind};D.setBind=function(d){this._cBind=d};V(D,P)})();(function(){var R=ecui,P=R.dom,J=R.ui,A=R.util,B=P.getStyle,Q=P.remove,S=P.setInput,G=A.blank,M=A.copy,H=A.inherits,N=A.toNumber,E=R.getMouseX,I=R.getParameters,D=J.Tree,K=J.Tree.prototype,L=J.Control.prototype;var O=J.RadioTree=function(T,U){U=M(M({},U),I(T));this._sValue=T.getAttribute("value")||U.value;this._sName=U.name;this._nfixLeftPadding=parseInt(U.fixPadding,10);D.call(this,T,U)},F=H(O,D);function C(T,U){T._eInput||T.getBody().appendChild(T._eInput=S("",T.getName(),"hidden"));T._eInput.value=U}F.$click=function(V){var W=this._nfixLeftPadding?this._nfixLeftPadding:0,T=E(this);if(T<=N(B(this.getBase(),"paddingLeft"))&&T>=W){var U=this.getRoot();U._cSelected&&U._cSelected.alterClass("select",true);this.alterClass("select");U._cSelected=this;C(U,this._sValue);this.setFold=G}K.$click.call(this,V);delete this.setFold};F.$dispose=function(){this._eInput=null;K.$dispose.call(this)};F.getName=function(){return this._sName};F.getSelected=function(){return this.getRoot()._cSelected};F.getValue=function(){return this._sValue};F.setParent=function(U){var T=this.getRoot();K.setParent.call(this,U);if(T._cSelected==this){this.alterClass("select",true);T._cSelected=null;C(T,"")}if(this._cSelected){this._cSelected.alterClass("select",true);this._cSelected=null;this._eInput&&Q(this._eInput)}}})();var ecomui=ecomui||{};(function(){var G=baidu,S=ecui,A=S.dom,l=G.dom,W=S.ui,H=S.util,E=H.inherits,k=H.copy,K=H.blank,I=S.$fastCreate,L=S.Timer,R=S.getParameters,h=l.g,N=A.children,d=A.create,j=A.insertHTML,B=A.setText,O=S.array.indexOf,X=A.getStyle,Z=l.hasClass,a=l.getAncestorBy,i=Math,T=i.ceil,D=document,F=W.Control,P=F.prototype,b=W.Item,Q=W.Items,M=b.prototype,J=W.Tab=function(n,r){var g=N(n),p=d("ec-tab-title ec-tab-title","overflow:hidden;position:relative"),m=0,q;n.insertBefore(p,g[0]);for(;q=g[m];m++){(q=N(q)[0]._eContent=N(q)[0].parentNode).className="ec-tab-content";if(R(q).current!==undefined){r.current=m}q=N(q)[0];q.className+=" ec-inline-block";q.innerHTML="<span class='ec-inline-block'>"+q.innerHTML+"</span>";p.appendChild(q)}this._uTitles=I(U,p,this,r);F.call(this,n,r)},c=E(J,F),U=function(p,s){var r=d("ec-tab-title-wrapper","overflow:hidden;position:relative"),m,g,q,n;p.parentNode.insertBefore(r,p);r.appendChild(p);g=this._eBody=p;F.call(this,p,s);this.$initItems();m=this._eBase=r;this._nCurIdx=s.current||0;(q=this._uPrev=I(F,r=d("ec-tab-title-prev ec-tab-title-scroll","position:absolute;"),this)).$pressstart=UI_TAB_TITLES_SCROLLPRESSSTART;m.insertBefore(r,g);(n=this._uNext=I(F,r=d("ec-tab-title-next ec-tab-title-scroll","position:absolute"),this)).$pressstart=UI_TAB_TITLES_SCROLLPRESSSTART;m.insertBefore(r,g);q._nDis=20;n._nDis=-20;this._nLeftPadding=20;this._nRightPadding=20;q.$pressover=n.$pressover=UI_TAB_TITLES_SCROLLPRESSSTART;q.$pressend=n.$pressend=UI_TAB_TITLES_SCROLLPRESSEND;q.$pressout=n.$pressout=UI_TAB_TITLES_SCROLLPRESSOUT;q.hide();n.hide();this.$init=UI_TAB_TITLES_INIT},C=E(U,F),Y=U.Item=function(g,m){b.call(this,g,m);content=this._eContent=g._eContent;g._eContent=undefined;content.style.visibility="hidden";content.style.position="absolute"},V=E(Y,b);c.$init=function(){P.$init.call(this);this._uTitles.init()};C.$alterItems=function(){};UI_TAB_TITLES_INIT=function(){P.$init.call(this);this.select(this._nCurIdx);var m=this.getItems(),p=0,s,r=0,n=this.getOuter(),g=this.getBody(),q=g.style;for(;s=m[p];p++){r+=s._nWidth+s.getInvalidWidth()+(parseInt(X(s.getOuter(),"marginRight"),10)||0)+5;if(this._nCurIdx!=p){s._eContent.style.display="none"}}this._nItemsWidth=r;if(r>this.getWidth()){q.left=(parseInt(q.left,10)||0)+this._nLeftPadding+"px";this._uPrev.show();this._uNext.show()}n.style.height=m[0]._nHeight+"px";g.style.width=r+"px";this.$alterItems()};c.$setSize=K;C.$setSize=K;c.$resize=function(){this._uTitles.resize();var g=this;setTimeout(function(){g.getOuter().className+=""},10)};C.$resize=function(){P.$resize.call(this);var n=this,m,g=n.getBody().style;g.display="none";m=this._eBase.offsetWidth,g.display="";n.getOuter().style.width=m+"px";if(n._nItemsWidth>m){n._uPrev.show();n._uNext.show()}else{g.left=0;n._uPrev.hide();n._uNext.hide()}n.$mouseover()};C.getInternalCtrls=function(g){var m=this.getItems()[g]._eContent,o=this.getParent();function n(q){var p=q.getOuter();return a(p,function(r){return r==m})}return S.query({parent:o,custom:n})};C.$select=function(m){var q;if(this._nLastIndex!==undefined){q=this.getItems()[this._nLastIndex];q.alterClass("selected",true);q._eContent.style.display="none"}q=this.getItems()[m];q.alterClass("selected");q._eContent.style.position="static";q._eContent.style.visibility="visible";q._eContent.style.display="block";this._oInitFlushed=this._oInitFlushed||{};if(this._oInitFlushed[m]!==true){for(var n=0,q,g=this.getInternalCtrls(m);q=g[n++];){try{q.resize()}catch(p){}}this._oInitFlushed[m]=true}this._nLastIndex=m};C.select=function(g){var m=this;if(m.onselect&&m.onselect(g)===false||m.$select(g)===false){return false}};V.$click=function(p){M.$click.call(this,p);var o=this.getParent(),m=O(o.getItems(),this),n=this.getOuter(),g=n.getAttribute("data-href");if(!g){o.select(m)}else{/selected/.test(n.className)||(window.location=g)}};C.moveBody=function(g){var n=this.getBody().style,o=n.left,m=this._nLeftPadding||20;RightPadding=this._nRightPadding||20;rightDiff=this.getOuter().offsetWidth-this._nItemsWidth;o=o?parseInt(o,10):0;if(o+g>m){n.left=m+"px"}else{if(o+g<rightDiff-RightPadding){n.left=rightDiff-RightPadding+"px"}else{n.left=o+g+"px";this._oTimer=new L(this.moveBody,50,this,g)}}};function f(g){var m=g._oTimer;m&&m.stop()}UI_TAB_TITLES_SCROLLPRESSSTART=function(g){P.$pressstart.call(this,g);this.getParent().moveBody(this._nDis);g.preventDefault()};UI_TAB_TITLES_SCROLLPRESSOVER=function(g){P.$pressover.call(this,g);this.getParent().moveBody(this._nDis)};UI_TAB_TITLES_SCROLLPRESSEND=function(g){P.$pressend.call(this,g);f(this.getParent())};UI_TAB_TITLES_SCROLLPRESSOUT=function(g){P.$pressout.call(this,g);f(this.getParent())};k(C,Q);C.$cache=function(m,p){P.$cache.call(this,m,p);for(var g=0,o=Q[this.getUID()],n;n=o[g++];){n.cache(true,true)}}})();var ecomui=ecomui||{},asynMgr=asynMgr||{};try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}(function(){var lib=baidu,core=ecui,dom=core.dom,libDom=lib.dom,ui=core.ui,string=core.string,init=core.init,domQuery=lib.dom.query,children=dom.children,insertHTML=dom.insertHTML,ieVersion=core.browser.ie,ffVersion=core.browser.firefox,$fastCreate=core.$fastCreate,createControl=core.create,util=core.util,inherits=util.inherits,copy=util.copy,toNumber=util.toNumber,get=core.get,query=core.query,on=lib.event.on,each=lib.array.each,blank=util.blank,disposeControl=core.dispose,loseFocus=core.loseFocus,removeDom=dom.remove,setText=dom.setText,getText=dom.getText,toCamelCase=string.toCamelCase,libAjax=lib.ajax,post=libAjax.post,request=libAjax.request,jsonToStr=lib.json.stringify,queryToJson=lib.url.queryToJson,createDom=dom.create,getViewWidth=lib.page.getViewWidth,getViewHeight=lib.page.getViewHeight,getScrollTop=lib.page.getScrollTop,setStyles=lib.dom.setStyles,getPosition=dom.getPosition,calcHeightRevise=core.calcHeightRevise,first=libDom.first,last=libDom.last,trim=lib.string.trim,getParameters=core.getParameters,ASYNCSTATEMGR=asynMgr,CLICKSHIELD,DOCUMENT=document,UI_LOCKED_TABLE=ui.LockedTable,UI_LOCKED_TABLE_CLASS=UI_LOCKED_TABLE.prototype,UI_TABLE=ui.Table,UI_TABLE_CLASS=UI_TABLE.prototype,UI_CONTROL=ui.Control,UI_CONTROL_CLASS=UI_CONTROL.prototype,UI_CHECKBOX=ui.Checkbox,UI_PAGER=ui.Pager,UI_PAGER_CLASS=UI_PAGER_CLASS,UI_SCROLL=ui.Scroll,UI_SCROLL_CLASS=UI_SCROLL.prototype,ECOM_TABLE_URL_DEFAULTS={pageParam:"page.curPageNum",orderByParam:"orderBy",descParam:"desc"},ECOM_TABLE=ecomui.Table=ui.EcomTable=function(el,params){var defaultUrl=params.defaultUrl,tbEl,pgEl,i=0,o,tmp;params.capture=false;this._sDefaultUrl=defaultUrl;this._sQueryUrl=params.queryUrl||defaultUrl;this._sPageUrl=params.pageUrl||defaultUrl;this._sSortUrl=params.sortUrl||defaultUrl;this._nTbId=params.tbId;for(o in ECOM_TABLE_URL_DEFAULTS){this["_s"+toCamelCase("-"+o)]=params[o]||ECOM_TABLE_URL_DEFAULTS[o]}UI_CONTROL.call(this,el,params);o=this._eMask=createDom("","position:absolute;opacity:0.7;filter:alpha(opacity=70);                            background-color:#FFF;top:0;left:0;display:none;                            z-index:32765;font-size:14px;text-align:center");o.innerHTML="<span class='ec-ecom-table-loading'></span>";if((tmp=children(el)).length>=1){tbEl=domQuery(".ec-ecom-table-el",el)[0];pgEl=domQuery(".ec-ecom-pager-el",el)[0];this._uTable=$fastCreate(ECOM_TABLE_BODY,tbEl,this,getParameters(tbEl));pgEl&&(this._uPager=$fastCreate(ECOM_PAGER,pgEl,this,getParameters(pgEl)));el.insertBefore(o,children(el)[0])}else{el.appendChild(o);if(jsonToStr(o=ASYNCSTATEMGR.getCurState("lst_"+this._nTbId))!="{}"){this.recover(o)}else{this.post(params.defaultUrl)}}},ECOM_TABLE_CLASS=inherits(ECOM_TABLE,UI_CONTROL),ECOM_TABLE_BODY=ui.EcomTableBody=function(el,params){el.innerHTML=el.innerHTML.replace(/>(\s+)</g,"><");var o,outerWidth;o=el.parentNode.getControl();try{outerWidth=(o._nWidth+0)||o.getOuter().offsetWidth}catch(e){outerWidth=Math.min(el.parentNode.offsetWidth,getViewWidth()-80)}outerWidth=outerWidth-2;el.style.width=outerWidth+"px";UI_LOCKED_TABLE.call(this,el,params);this._bSyncOp=params.syncOp==true;this._bCustom=params.custom;this._bNoData=params.noData===true;if(params.rightLock){this._bOpColUnfolded=true;el=this.getBase();(this._uColToggler=$fastCreate(UI_CONTROL,o=createDom("ec-col-toggler"),this)).$click=ECOM_TABLE_TOGGLERCLICK;el.appendChild(o);ieVersion>=8&&(o.style.display="none");(this._uVerticalBar=$fastCreate(ECOM_TABLE_VBAR,o=createDom("ec-v-toggler"),this)).$click=ECOM_TABLE_VBARCLICK;o.innerHTML="<div></div>";el.appendChild(o);this._uVerticalBar.hide();this._uVerticalBar.show=ECOM_TABLE_VBARSHOW;o=this._uVScroll;this._uColToggler.getOuter().style.right=((o&&o.isShow())?o.getWidth():0)+"px"}if(params.floatThead){var self=this;self._bFloatThead=true;on(window,"scroll",function(){ECOM_TABLE_FLOATTHEAD(self)})}},ECOM_TABLE_BODY_CLASS=inherits(ECOM_TABLE_BODY,UI_LOCKED_TABLE),ECOM_PAGER=ui.EcomPager=function(el,params){UI_PAGER.call(this,el,params)},ECOM_PAGER_CLASS=inherits(ECOM_PAGER,UI_PAGER),ECOM_TABLE_VBAR=function(el,params){UI_CONTROL.call(this,el,params)},ECOM_TABLE_VBAR_CLASS=inherits(ECOM_TABLE_VBAR,UI_CONTROL),ECOM_TABLE_BODY_ROW=ECOM_TABLE_BODY.Row=function(el,params){UI_LOCKED_TABLE.Row.call(this,el,params);var o=el.cells[0].getElementsByTagName("input");if(o[0]&&o[0].type=="checkbox"){o=o[0];o.value=trim(o.value);this._cCheckbox=createControl("checkbox",{element:o,superior:o.getAttribute("data-superior")})}},ECOM_TABLE_BODY_ROW_CLASS=inherits(ECOM_TABLE_BODY_ROW,UI_LOCKED_TABLE.Row);ECOM_TABLE_CLASS.$cache=function(style,cacheSize){UI_CONTROL_CLASS.$cache.call(this,style,cacheSize);this._uTable&&this._uTable.cache();this._uPager&&this._uPager.cache()};ECOM_TABLE_CLASS.$init=function(){UI_CONTROL_CLASS.$init.call(this);this._uTable&&this._uTable.init();this._uPager&&this._uPager.init();document.body.offsetWidth;this._uTable&&this.resize()};ECOM_TABLE_CLASS.$setSize=blank;ECOM_TABLE_CLASS.$resize=function(){var that=this,fn=function(){var outer=that.getOuter(),table=that._uTable,pager=that._uPager,width,scrollTop;if(table&&table.getOuter()){scrollTop=getScrollTop();table.hide();pager&&pager.hide();document.body.offsetWidth;outer.style.width="100%";width=outer.offsetWidth;outer.style.width="";table.show();pager&&pager.show();width=ieVersion<8?width:outer.offsetWidth;table.setSize(width);if(table._uVerticalBar&&table._uVerticalBar.isShow()){table._uVerticalBar.resize()}document.body.offsetWidth;outer.className+="";window.scrollTo(0,scrollTop)}};if(ieVersion<8){setTimeout(fn,10)}else{fn()}};ECOM_TABLE_CLASS.onresize=function(){};ECOM_TABLE_CLASS.onShieldInit=function(){CLICKSHIELD=core.ext.clickShield};ECOM_TABLE_BODY_CLASS.$init=function(){UI_LOCKED_TABLE_CLASS.$init.call(this);var headCell=this.getCol(0).getOuter(),o;this._uOpCol=this.getCol(this._aCol.length-1);o=headCell.getElementsByTagName("input");if(o[0]&&o[0].type=="checkbox"){o=o[0];this._cHeadCheckbox=createControl("checkbox",{id:o.getAttribute("data-id"),element:o})}this._uHead.getBody().cells[0].getControl().constructor.prototype.$click=ECOM_TABLE_HEADCELLCLICK;if(this._bCustom){var customBtn=core.get("cbCtnr_"+this._nTbId);customBtn&&ECOM_TABLE_CUSTOMBTNINIT(customBtn,this)}};ECOM_TABLE_BODY_CLASS.$mousemove=function(event){var outer=this.getOuter(),pos=getPosition(outer),offsetX=event.pageX-pos.left+this.getScrollLeft();console.log(0);this._nOldX=offsetX;if(event.pageY-pos.top<this._uHead.getHeight()){for(var i=0,cols=this.getCols(),o;o=cols[i];i++){offsetX-=o.getWidth();if(Math.abs(offsetX)<3){outer.style.cursor="col-resize";this._nDragCol=i;return }else{if(offsetX<0){break}}}}outer.style.cursor=""};ECOM_TABLE_BODY_CLASS.$mousedown=function(event){var outer=this.getOuter();if(outer.style.cursor){this.onmousemove=ECOM_TABLE_BODY_DRAGMOVE;this.onmouseup=ECOM_TABLE_BODY_DRAGUP}};function ECOM_TABLE_BODY_DRAGMOVE(event){var outer=this.getOuter(),pos=getPosition(outer),offsetX=event.pageX-pos.left+this.getScrollLeft(),col=this.getCols()[this._nDragCol],minWidth=col._nMinWidth||Math.max(50,getText(col.getOuter()).length*15+col.getInvalidWidth()),deltaWidth=Math.max(minWidth-col._nWidth,offsetX-this._nOldX);col._nMinWidth=minWidth;col.setSize(col._nWidth+deltaWidth);this._nOldX+=deltaWidth;this.paint();return false}function ECOM_TABLE_BODY_DRAGUP(event){delete this.onmousemove;delete this.onmouseup}ECOM_TABLE_CLASS.post=function(url,options){var asyncMgr=this._oAsyncMgr=new ASYNCMGR();this.setLocked(true);asyncMgr.beforePost=ECOM_TABLE_BEFOREPOST;asyncMgr.onerror=this.onReqError;asyncMgr.post(this,url,options).$success=function(control,xhr,res,reqInfo){this.constructor.prototype.$success.call(this,control,xhr,res,reqInfo);var data=reqInfo.data;ASYNCSTATEMGR.updateStateData(data);control.onReqSuccess&&control.onReqSuccess.call(this,control,xhr,res)};return asyncMgr};ECOM_TABLE_CLASS.recover=function(data){var asyncMgr=this._oAsynMgr=new ASYNCMGR(),urlType=queryToJson(ECOM_TABLE_GETTBSTATE(this,data)).urlType||"default",url=this["_s"+toCamelCase("-"+urlType)+"Url"];this.setLocked(true);asyncMgr.beforePost=ECOM_TABLE_BEFOREPOST;asyncMgr.post(this,url,{data:data}).$success=function(control,xhr,res,reqInfo){this.constructor.prototype.$success.call(this,control,xhr,res,reqInfo);control.onReqSuccess&&control.onReqSuccess.call(this,control,xhr,res)};return asyncMgr};function ECOM_TABLE_GETTBSTATE(control,data){return data["lst_"+control._nTbId]||""}function ECOM_TABLE_SETTBSTATE(control,data,str){data["lst_"+control._nTbId]=str;return data}function ECOM_TABLE_BEFOREPOST(control,url,options){var data=ASYNCSTATEMGR.convertToUrl(options.data);return{url:url,data:data}}ECOM_TABLE_CLASS.asynQuery=function(data){var o=ECOM_TABLE_GETTBSTATE(this,data),data;o+="&urlType=query";data=ECOM_TABLE_SETTBSTATE(this,data,o);this.post(this._sQueryUrl,{data:data})};ECOM_PAGER_CLASS.$init=function(){UI_PAGER.$init&&UI_PAGER.$init.call(this);this.setSize(this.getParent()._uTable.getWidth())};function ECOM_TABLE_TOGGLERCLICK(event){UI_CONTROL_CLASS.$click.call(this,event);var table=this.getParent(),vBar=table._uVerticalBar;ECOM_TABLE_TOGGLEOPCOL(table)}function ECOM_TABLE_TOGGLEOPCOL(control,foldFlag){var foldFlag=foldFlag||control._bOpColUnfolded,col=control.getCol(control.getCols().length-2);control._uOpCol[foldFlag?"hide":"show"]();if(control._uHScroll&&control._uHScroll.isShow()){col.setSize(col.getWidth());document.body.offsetWidth;control.setSize(control.getParent().getWidth()-control.getParent().getInvalidWidth())}else{document.body.offsetWidth;col.setSize(col.getWidth()+(foldFlag?1:-1)*control._uOpCol.getWidth())}control._uColToggler.alterClass("o",!foldFlag);control._uVerticalBar[foldFlag?"show":"hide"]();control._bOpColUnfolded=!foldFlag}function ECOM_TABLE_VBARCLICK(event){UI_CONTROL_CLASS.$click.call(this,event);ECOM_TABLE_TOGGLEOPCOL(this.getParent(),false)}function ECOM_TABLE_VBARSHOW(){UI_CONTROL.prototype.show.call(this);this.resize()}function ECOM_TABLE_FLOATTHEAD(t){var headEl=t._uHead.getOuter(),lockedHeadEl=t._uLockedHead.getOuter(),lockedMainEl=t._uLockedMain.getOuter();if(t._uColToggler){var colTogglerEl=t._uColToggler.getOuter()}var outer=t.getOuter();var scrollTop=DOCUMENT.body.scrollTop||DOCUMENT.documentElement.scrollTop,pos=getPosition(outer),top=pos.top+1,left=pos.left;var headHeight=headEl.offsetHeight+calcHeightRevise(headEl),tbHeightDelta=t.getHeight()-headHeight,relativeTop=scrollTop-top;var floatStyles={position:"absolute",top:relativeTop+"px",zIndex:999};if(scrollTop&&relativeTop>0&&relativeTop<tbHeightDelta){setStyles(headEl,floatStyles);setStyles(lockedHeadEl,floatStyles);setStyles(lockedMainEl,{top:headHeight+"px"});setStyles(lockedHeadEl,{width:lockedHeadEl.getElementsByTagName("table")[0].style.width});if(colTogglerEl){setStyles(colTogglerEl,{top:2+relativeTop+"px",zIndex:999})}}else{setStyles(headEl,{top:0,zIndex:0});setStyles(lockedHeadEl,{position:"static",zIndex:0});setStyles(lockedMainEl,{top:""});if(colTogglerEl){setStyles(colTogglerEl,{top:"",zIndex:0})}}}function ECOM_TABLE_CUSTOMBTNINIT(customBtn,table){var tbId=table._nTbId;var popup=core.get("cbPop_"+tbId),popupItems=core.query({parent:popup}),popupItemsLen=popupItems.length;var cbCurList=core.get("cball_"+tbId),cbWholeList=core.get("cbsall_"+tbId),cbCurInferiors=cbCurList.getInferiors();DOCUMENT.body.appendChild(popup.getOuter());customBtn.onclick=function(){var containerOuter=this.getOuter();containerPos=getPosition(containerOuter);popup.setPosition(containerPos.left+this.getBodyWidth(),containerPos.top);popup.show()};cbWholeList.onclick=(function(){var checked=false;return function(){var i=cbCurInferiors.length,msg=["已选择整列表, 子项目不能取消选择","已取消选择整列表"];var msgBox=table.setMsg((!checked)?msg[0]:msg[1]);msgBox.parentNode.parentNode.style.visibility="visible";var hcbsall=lib.dom.g("hcbsall_"+tbId);while(i--){cbCurInferiors[i].setChecked(!checked);cbCurList.setEnabled(checked);cbCurInferiors[i].setEnabled(checked)}hcbsall.value=checked?0:1;checked=!checked}})();while(popupItemsLen--){popupItems[popupItemsLen].onclick=function(){var cb=core.query({parent:this})[0];cb.click()}}}ECOM_TABLE_VBAR_CLASS.$resize=function(){UI_CONTROL_CLASS.$resize.call(this);var table=this.getParent(),width=this.getWidth(),vScroll=table._uVScroll,hScroll=table._uHScroll,style=table.getBase().style,contentWidth=table.getWidth()-(toNumber(style.borderLeftWidth)+toNumber(style.borderRightWidth)),o;style=this.getOuter().style;style.left=contentWidth-width-((vScroll&&vScroll.isShow())?vScroll.getWidth():0)+"px";if(hScroll&&hScroll.isShow()){o=hScroll.isShow()?hScroll.getHeight():0}else{o=0}this.setSize(0,table.getBodyHeight()-o);style.bottom=o+"px"};ECOM_TABLE_BODY_CLASS.$setSize=function(width,height){if(this._cVScroll&&!this._cVScroll.isShow()){this._cVScroll._nWidth=0}try{UI_LOCKED_TABLE_CLASS.$setSize.call(this,width,height);if(ffVersion){for(var i=0,o,lockedRow;lockedRow=this._aLockedRow[i++];){o=lockedRow._cJoint.getCol(this._nLeft).getOuter();o.getElementsByTagName("div")[0].style.height=o.style.height}}}catch(e){}};ECOM_TABLE_BODY_CLASS.$resize=function(){UI_LOCKED_TABLE_CLASS.$resize.call(this);this._uVerticalBar&&this._uVerticalBar.resize();this._bFloatThead&&ECOM_TABLE_FLOATTHEAD(this)};function ECOM_TABLE_HEADCELLCLICK(event){var el=this.getOuter(),o;if((o=el.getAttribute("sort"))!==null){ECOM_TABLE_BODY_CLASS.sort.call(this,o)}UI_CONTROL_CLASS.$click.call(this,event)}ECOM_TABLE_BODY_CLASS.$sort=function(orderBy){var parent=this.getParent().getParent(),orderByParam=parent._sOrderByParam,descParam=parent._sDescParam,sortUrl=parent._sSortUrl,desc,data=ASYNCSTATEMGR.getCurState("lst_"+parent._nTbId),sortProps=[[orderByParam,orderBy].join("="),[descParam,desc=parent.getNextDesc(orderBy)].join("=")].join("&");sortProps+="&urlType=sort";data=ECOM_TABLE_SETTBSTATE(parent,data,sortProps);parent.post(sortUrl,{data:data})};ECOM_TABLE_CLASS.getNextDesc=function(orderBy){return this._sOrderByVal==orderBy?!this._bDesc:false};ECOM_TABLE_BODY_CLASS.sort=function(orderBy){var o=this.getParent();o.isEnabled()&&o.onsort&&o.onsort.call(this,orderBy)===false||o.$sort.call(this,orderBy)};ECOM_TABLE_CLASS.renderBody=function(html){var outer=this.getOuter(),self=this,tbEl,pgEl;if(this._uTable){this._uTable.setEnabled(false);disposeControl(this._uTable);removeDom(domQuery(".ec-ecom-table-el",outer)[0])}if(this._uPager){this._uPager.setEnabled(false);disposeControl(this._uPager);try{removeDom(domQuery(".ec-ecom-pager-el",outer)[0])}catch(e){}}each(children(outer),function(n,i){if(n!=self._eMask){removeDom(n)}});insertHTML(this._eMask,"afterEnd",html);tbEl=domQuery(".ec-ecom-table-el",outer)[0];pgEl=domQuery(".ec-ecom-pager-el",outer)[0];if(tbEl){this._uTable=$fastCreate(ECOM_TABLE_BODY,tbEl,this,getParameters(tbEl));this._uTable.cache();this._uTable.init()}if(pgEl){this._uPager=$fastCreate(ECOM_PAGER,pgEl,this,getParameters(pgEl));this._uPager.cache();this._uPager.init()}this.resize()};ECOM_TABLE_BODY_CLASS.getChecked=function(){var ret=[];try{var col=this.getCol(0),cbs=core.get("cball_"+this.getParent()._nTbId),cbs=(cbs instanceof core.ui.Checkbox)?cbs:core.query({parent:cbs})[0],cbs=cbs.getInferiors(),i=cbs.length;while(i--){if(cbs[i].isChecked()){ret.push(cbs[i].getParent())}}}catch(e){}return ret};ECOM_TABLE_BODY_CLASS.getCheckedCount=function(){return this.getChecked().length};ECOM_TABLE_BODY_CLASS.getCheckedStr=function(name){var ret=[];try{this.eachRow(function(n,i,cb){if(cb&&cb.isChecked()){ret.push([name||cb.getName(),cb.getValue()].join("="))}})}catch(e){}return ret.length>0?ret.join("&"):""};ECOM_TABLE_BODY_CLASS.setMsg=function(msg){var msgBox=lib.dom.g("tbMsg_"+this.getParent()._nTbId);dom.setText(msgBox,msg);return msgBox};ECOM_TABLE_BODY_CLASS.eachRow=function(func){each(this._aRow,function(n,i){var checkbox=n._cCheckbox;func&&func.call(n,n,i,checkbox)})};ECOM_TABLE_BODY_CLASS.checkRows=function(func){this.eachRow(function(n,i,checkbox){checkbox.setChecked(false);if(func&&func.call(n,n,i,checkbox)){checkbox.setChecked(true)}})};ECOM_TABLE_BODY_CLASS.isEmpty=function(){return this._bNoData};(function(){var methodNames=["getChecked","getCheckedCount","getCheckedStr","isEmpty","eachRow","checkRows"];for(var i=0,o;o=methodNames[i++];){ECOM_TABLE_CLASS[o]=(function(){var method=o;return function(){var t=this._uTable;return t[method].apply(t,arguments)}})()}})();ECOM_PAGER_CLASS.onpageset=function(pageNum){var parent=this.getParent(),pageParam=parent._sPageParam,pageUrl=""+parent._sPageUrl,pageProps=[pageParam,pageNum].join("="),data=ASYNCSTATEMGR.getCurState("lst_"+parent._nTbId);if(parent._uTable._bSyncOp){parent.setLocked(true);location.href=document.forms.query.action+"?"+pageParam+"="+pageNum;return }if(parent._sOrderByVal){pageProps+="&"+[[parent._sOrderByParam,parent._sOrderByVal].join("="),[parent._sDescParam,parent._bDesc].join("=")].join("&")}pageProps+="&urlType=page";data=ECOM_TABLE_SETTBSTATE(parent,data,pageProps);parent.post(pageUrl,{data:data});return false};ECOM_TABLE_CLASS.setLocked=function(lock,msg){if(lock){this.lock(msg);(CLICKSHIELD)&&(CLICKSHIELD.lock(this))}else{this.unlock();(CLICKSHIELD)&&(CLICKSHIELD.unlock(this))}};ECOM_TABLE_CLASS.lock=function(msg){var mask=this._eMask,msg=msg||"请稍候...",outer=this.getOuter(),height,lineHeight;height=Math.max(outer.offsetHeight,100);lineHeight=Math.min(height,getScrollTop()+getViewHeight()-Math.min(outer.offsetTop,getScrollTop()));setStyles(mask,{width:outer.offsetWidth,height:height+"px",lineHeight:lineHeight+"px",display:"block"});setStyles(outer,{height:height+"px"});setText(mask.getElementsByTagName("span")[0],msg)};ECOM_TABLE_CLASS.unlock=function(msg){var mask=this._eMask,outer=this.getOuter();mask.style.display="none";document.body.offsetWidth;outer.style.height="";document.body.offsetWidth;outer.className+=""};UI_TABLE_CLASS.removeRows=function(){this.paint=blank;for(var i=0,len=this.getRows().length;i<len;i++){try{this.removeRow(0)}catch(e){}}delete this.paint;this.paint()};UI_TABLE_CLASS.addRows=function(data){this.paint=blank;for(var i=0,o;o=data[i++];){o!==undefined&&this.addRow(o)}delete this.paint;this.paint()};UI_TABLE_CLASS.update=function(data){this.removeRows();this.addRows(data)};ECOM_TABLE_CLASS.getCellHTML=function(x,y){var ret="";try{ret=this._uTable.getRows()[x].getCols()[y].getOuter()}catch(e){throw new Error("没有找到单元格")}ret=ret.getElementsByTagName("div")[0].innerHTML;return ret};ECOM_TABLE_CLASS.getRowCount=function(){return this._uTable.getRows().length};ECOM_TABLE_CLASS.getHeadData=function(){var ths=this._uTable._uHead.getOuter().getElementsByTagName("th"),ret=[];each(ths,function(n,i){ret.push(getText(n))});return ret};ECOM_TABLE_CLASS.getHeadDataStr=function(){return jsonToStr(this.getHeadData())};ECOM_TABLE_CLASS.getBodyData=function(){var content=this._uTable.getBody().getElementsByTagName("table")[0],rows=content.rows,ret=[];for(var i=0,o;o=rows[i];i++){ret.push([]);o=o.cells;for(var j=0,p;p=o[j++];){ret[i].push(getText(p))}}return ret};ECOM_TABLE_CLASS.getBodyDataStr=function(){return jsonToStr(this.getBodyDataStr())};var ASYNCMGR=ECOM_TABLE.AsyncMgr=function(){},ASYNCMGR_CLASS=ASYNCMGR.prototype,callbackNames=["success","error"];ASYNCMGR_CLASS.post=function(ecId,url,options){var control=typeof ecId=="string"?core.get(ecId):ecId,options=options||{},newUrl,newData,o={},self=this;if(this.beforePost){o=this.beforePost(control,url,options)}newUrl=o.url||url;newData=o.data||options.data||"";request(newUrl,{method:"POST",async:true,data:newData+"&feReqTime="+new Date().getTime(),onsuccess:(function(){return function(xhr,res){self.success.call(self,control,xhr,res,{url:url,data:options.data||{}})}})(),onfailure:(function(){return function(xhr,res){self.error.call(self,control,xhr,res)}})()});return this};ASYNCMGR_CLASS.$success=function(control,xhr,res,reqInfo){var o;try{var data=trim(res).replace(/\$tbId/g,control._nTbId)}catch(e){alert(["JSON数据解析错误",e.name,e.message].join("\n"));control.setLocked(false);return }data!=""&&control.renderBody(data);control.setLocked(false);o=queryToJson(ECOM_TABLE_GETTBSTATE(control,reqInfo.data));if(o[control._sOrderByParam]){control._sOrderByVal=o[control._sOrderByParam];control._bDesc=eval(o[control._sDescParam])}};ASYNCMGR_CLASS.$error=function(control,xhr,res){alert(["请求错误, 请稍后重试","状态码: "+xhr.status,"信息: "+xhr.statusText].join("\n"));control.setLocked(false)};(function(){for(var i=0,o;o=callbackNames[i++];){ASYNCMGR_CLASS[o]=new Function("control","xhr","res","reqInfo","var o=this;o.on"+o+"&&o.on"+o+".call(o, control, xhr, res, reqInfo)===false||o.$"+o+".call(o, control, xhr, res, reqInfo)")}})();ecomui.getTable=function(name){if(typeof name=="string"){return core.get(str)}else{if(typeof name=="number"){return core.query({type:ui.EcomTable})[name]||null}else{return core.query({type:ui.EcomTable})[0]||null}}}})();